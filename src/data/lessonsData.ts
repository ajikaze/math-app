import type { GraphData } from "../types/index";

// 学習ステップの落とし穴の型定義
interface Pitfall {
    title: string;
    detail: string;
}

// 練習問題の型定義
export interface Problem {
    question: string;
    answer: string;
    hint: string;
}

// 学習ステップの型定義
export interface LearningStep {
    title: string;
    explanation: string;
    pitfall: Pitfall;
    problems?: Problem[];
    graphs?: GraphData[]; // JSXGraph用グラフ情報
}

// 学習トピックの型定義
export interface LearningTopic {
    topic: string;
    steps: LearningStep[];
}

// 科目データの型定義
interface SubjectData {
    [key: string]: LearningTopic[];
}

// LaTeX変換用の正規表現置換関数
export function toLatexMath(str: string): string {
    if (!str) return str;
    let s = str;
    // 「ポイント：」の前後に改行を追加
    s = s.replace(/\n?\s*ポイント：/g, "\n\nポイント：\n");
    // 改行を<br>に変換
    s = s.replace(/\n/g, "<br>");
    // sqrt(2) → \sqrt{2}
    s = s.replace(/sqrt\(([^)]+)\)/g, "\\sqrt{$1}");
    // <=, >=
    s = s.replace(/<=/g, " \\le ");
    s = s.replace(/>=/g, " \\ge ");
    // pi → \pi
    s = s.replace(/\bpi\b/g, "\\pi");
    // 分数 例: 1/2 → \frac{1}{2}（ただし小数や式の一部でない場合のみ）
    s = s.replace(
        /(?<![\d.])([0-9]+)\s*\/\s*([0-9]+)(?![\d.])/g,
        "\\frac{$1}{$2}"
    );
    // 乗数 例: x^2 → x^{2}
    s = s.replace(/([a-zA-Z0-9]+)\^(-?[a-zA-Z0-9]+)/g, "$1^{$2}");
    return s;
}

// problemsのanswerをLaTeX記法に自動変換
function normalizeProblems(problems: Problem[]): Problem[] {
    return problems.map((p) => {
        let answer = p.answer;
        if (typeof answer === "string") {
            answer = toLatexMath(answer);
        }
        return { ...p, answer };
    });
}

// 数学I の学習コンテンツ
const math1Lessons: LearningTopic[] = [
    {
        topic: "式の計算",
        steps: [
            {
                title: "多項式の展開と因数分解",
                explanation: `
  「展開」とは、かっこの中にある式を分配法則で広げて、かっこをなくすことです。
  たとえば、$(x+2)(x+3)$ のような式を、$x^2 + 5x + 6$ のように書き直します。

  「因数分解」とは、展開の逆で、バラバラになっている式をかっこの形にまとめることです。
  たとえば、$x^2 + 5x + 6$ を $(x+2)(x+3)$ のようにします。

  ポイント：
  ・展開は「かっこを外す」
  ・因数分解は「かっこを作る」
  ・どちらも計算の基本なので、しっかり練習しましょう！
`,
                pitfall: {
                    title: "よくある間違い：符号ミスや項の漏れ",
                    detail: `
展開では、すべての項を掛け合わせているか、符号が正しいかを確認しましょう。
因数分解では、公式を正しく適用できているか、共通因数を見落としていないか注意が必要です。
`,
                },
                problems: normalizeProblems([
                    {
                        question: "$(x+3)(x-2)$ を展開しなさい。",
                        answer: "$x^2+x-6$",
                        hint: "分配法則を使いましょう。",
                    },
                    {
                        question: "$x^2 - 5x + 6$ を因数分解しなさい。",
                        answer: "$(x-2)(x-3)$",
                        hint: "掛けて6、足して-5になる2つの数を見つけましょう。",
                    },
                ]),
            },
            {
                title: "実数と根号",
                explanation: `
  「実数」とは、分数で表せる数（有理数）と、分数で表せない数（無理数）を合わせたものです。
  たとえば、1/2 や 3 は有理数、√2 や π は無理数です。

  「根号（ルート）」の計算では、
  ・$\\sqrt{a} × \\sqrt{b} = \\sqrt{a×b}$
  ・$\\sqrt{a} ÷ \\sqrt{b} = \\sqrt{a÷b}$
  などの性質を使います。

  また、分母にルートがあるときは「有理化」といって、分母からルートをなくす工夫をします。
  例：$\\frac{1}{\\sqrt{2}} → \\frac{\\sqrt{2}}{2}$

  ポイント：
  ・ルートの計算は、できるだけ中を小さくする
  ・分母にルートがあれば有理化する
`,
                pitfall: {
                    title: "よくある間違い：根号の足し算・引き算",
                    detail: `
$\\sqrt{2} + \\sqrt{3} = \\sqrt{5}$ のように計算してしまうのは間違いです。
根号の中の数が同じ場合のみ、係数を足し引きできます。例：$2\\sqrt{3} + 4\\sqrt{3} = 6\\sqrt{3}$
`,
                },
                problems: normalizeProblems([
                    {
                        question: "$\\sqrt{18} + \\sqrt{8}$ を簡単にしなさい。",
                        answer: "$5\\sqrt{2}$",
                        hint: "根号の中をできるだけ小さくしましょう。",
                    },
                    {
                        question: "$\\frac{1}{\\sqrt{3}-1}$ を有理化しなさい。",
                        answer: "$\\frac{\\sqrt{3}+1}{2}$",
                        hint: "分母と分子に何を掛ければ良いでしょうか？",
                    },
                ]),
            },
        ],
    },
    {
        topic: "方程式と不等式",
        steps: [
            {
                title: "1次方程式・不等式",
                explanation: `
  「1次方程式」とは、$x$などの文字が1回だけ出てくる式 $ax+b=0$ のことです。
  文字を含む項を片側に、数字だけの項をもう片側に集めて、xを求めます。

  「1次不等式」は、$ax+b>0$ のように不等号 $>$ や $<$ がついた式です。
  解き方は方程式とほぼ同じですが、
  「両辺をマイナスで割るときは、不等号の向きが逆になる」ことに注意しましょう。

  ポイント：
  ・方程式は「$=$」で、答えは1つ
  ・不等式は「$>$」「$<$」などで、答えが範囲になることもある
  ・マイナスで割るときは不等号の向きに注意！
`,
                pitfall: {
                    title: "よくある間違い：負の数で割る際の不等号の向き",
                    detail: `
$-2x > 4$ を解く際に、$x > -2$ としてしまうのは間違いです。
両辺を負の数 $(-2)$ で割るため、不等号の向きが逆になり、$x < -2$ が正解です。
`,
                },
                problems: normalizeProblems([
                    {
                        question: "$3x - 5 = 7$ を解きなさい。",
                        answer: "$4$",
                        hint: "定数項を右辺に移項しましょう。",
                    },
                    {
                        question: "$2x + 3 < 7$ を解きなさい。",
                        answer: "$x<2$",
                        hint: "負の数で割る場合に注意しましょう。",
                    },
                ]),
            },
            {
                title: "2次方程式",
                explanation: `
  「2次方程式」とは、$x^2$が出てくる式 $ax^2+bx+c=0$ のことです。
  解き方はいくつかあります。
  ・因数分解（かっこにまとめる）
  ・平方完成（$x^2$の形に直す）
  ・解の公式（どんな式でも使える便利な公式）

  また、「判別式 $D=b^2-4ac$」を使うと、答えが何個あるかも分かります。

  ポイント：
  ・まずは因数分解できるか考える
  ・できなければ平方完成や解の公式を使う
  ・判別式で答えの個数もチェック！
`,
                pitfall: {
                    title: "よくある間違い：解の公式の符号ミス",
                    detail: `
解の公式の $-b$ や $2a$ の符号、$\\pm$ の後の根号内の計算ミスが多いです。
特に、判別式 $D$ の計算は慎重に行いましょう。
`,
                },
                problems: normalizeProblems([
                    {
                        question: "$x^2 - 5x + 6 = 0$ を解きなさい。",
                        answer: "$2, 3$",
                        hint: "因数分解を試みましょう。",
                    },
                    {
                        question: "$x^2 + 2x - 1 = 0$ を解きなさい。",
                        answer: "$-1±\\sqrt{2}$",
                        hint: "解の公式を使いましょう。",
                    },
                ]),
            },
            {
                title: "2次不等式",
                explanation: `
  「2次不等式」とは、$x^2$が出てくる不等式 $ax^2+bx+c>0$ などのことです。
  2次関数のグラフ（放物線）とx軸の位置関係を考えて、どの範囲で条件を満たすかを調べます。

  たとえば、グラフがx軸より上にある部分が「$>0$」、下にある部分が「$<0$」に対応します。

  ポイント：
  ・まず2次方程式でx軸との交点（解）を求める
  ・グラフの形（上に凸か下に凸か）を確認
  ・どの範囲で条件を満たすか、グラフでイメージしよう！
`,
                pitfall: {
                    title: "よくある間違い：グラフの概形と不等号の向き",
                    detail: `
2次不等式を解くには、対応する2次方程式の解（x軸との交点）を求め、グラフの概形（上に凸か下に凸か）を正確に把握することが重要です。
不等号の向きと、グラフのどの部分が条件を満たすのかを混同しないようにしましょう。
`,
                },
                problems: normalizeProblems([
                    {
                        question: "$x^2 - 4x + 3 > 0$ を解きなさい。",
                        answer: "$x<1, x>3$",
                        hint: "対応する2次方程式の解を求め、グラフを描いてみましょう。",
                    },
                    {
                        question: "$x^2 - 2x - 8 \\le 0$ を解きなさい。",
                        answer: "$-2\\le x\\le 4$",
                        hint: "因数分解して、x軸との交点を見つけましょう。",
                    },
                ]),
            },
        ],
    },
    {
        topic: "2次関数",
        steps: [
            {
                title: "2次関数のグラフ",
                explanation: `
  2次関数 $y=ax^2+bx+c$ のグラフは「放物線」と呼ばれる曲線です。
  標準形 $y=a(x-p)^2+q$ に直すと、頂点（グラフの一番高い・低い点）が$(p, q)$とすぐに分かります。

  $a$ がプラスなら下に開いたU字型、マイナスなら上に開いた山型になります。

  ポイント：
  ・標準形に直すと頂点が分かりやすい
  ・$a$ の符号でグラフの向きが決まる
  ・グラフを描いてイメージしよう！
`,
                pitfall: {
                    title: "よくある間違い：頂点の符号ミス",
                    detail: `
$y = a(x-p)^2 + q$ の頂点は $(p, q)$ ですが、$y = (x+1)^2 + 2$ の頂点を $(1, 2)$ と間違えることがあります。
正しくは $(-1, 2)$ です。$(x-p)$ の形に注意しましょう。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "2次関数 $y = (x-3)^2 + 1$ の頂点の座標を求めなさい。",
                        answer: "$(3,1)$",
                        hint: "標準形 $y = a(x-p)^2 + q$ の頂点は $(p, q)$ です。",
                    },
                    {
                        question:
                            "2次関数 $y = x^2 - 4x + 5$ の頂点の座標を求めなさい。",
                        answer: "$(2,1)$",
                        hint: "平方完成して標準形にしましょう。",
                    },
                ]),
            },
            {
                title: "2次関数の最大・最小",
                explanation: `
  2次関数の「最大値・最小値」は、グラフの頂点や、$x$ の範囲（定義域）の端で決まります。
  まず頂点の $y$ 座標を調べ、次に $x$ の範囲の端でも $y$ の値を計算して、一番大きい・小さい値を比べます。

  グラフを描いて、どこが一番高いか・低いかを考えると分かりやすいです。

  ポイント：
  ・頂点が範囲内にあるかチェック
  ・端の値も必ず計算する
  ・グラフで視覚的に考えるとミスが減る！
`,
                pitfall: {
                    title: "よくある間違い：定義域の考慮不足",
                    detail: `
頂点が定義域の外にある場合でも、頂点の $y$ 座標を最大値・最小値としてしまう間違いが多いです。
必ず、定義域の端点での値も計算し、それらと頂点の $y$ 座標を比較して、最も大きい値が最大値、最も小さい値が最小値であることを確認しましょう。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "関数 $y = (x-1)^2 + 2$ の $0 \\le x \\le 3$ における最大値と最小値を求めよ。",
                        answer: "最大値: $6$, 最小値: $2$",
                        hint: "グラフの頂点と定義域の端点での値を比較しましょう。",
                    },
                    {
                        question:
                            "関数 $y = (x-3)^2 + 1$ の $0 \\le x \\le 2$ における最大値と最小値を求めよ。",
                        answer: "最大値: $10$, 最小値: $2$",
                        hint: "グラフの頂点と定義域の端点での値を比較しましょう。",
                    },
                ]),
            },
        ],
    },
    {
        topic: "三角比",
        steps: [
            {
                title: "三角比の定義",
                explanation: `
  「三角比」とは、直角三角形の角度と辺の長さの関係を表す比（わり算）のことです。
  ・$\\sin$（サイン）＝対辺 ÷ 斜辺
  ・$\\cos$（コサイン）＝隣辺 ÷ 斜辺
  ・$\\tan$（タンジェント）＝対辺 ÷ 隣辺

  どんな大きさの三角形でも、同じ角度なら三角比の値は同じです。

  ポイント：
  ・「どの角度から見たか」で対辺・隣辺が変わる
  ・三角比は三角形の大きさに関係なく使える
`,
                pitfall: {
                    title: "よくある間違い：辺の対応関係の混同",
                    detail: `
どの辺が「対辺」「隣辺」「斜辺」なのかを、基準となる角度から見て正確に把握することが重要です。
特に、直角三角形の向きが変わると混乱しやすいので注意しましょう。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "直角三角形ABCで、$\\angle C = 90^\\circ$, AB=5, BC=3, CA=4 のとき、$\\sin A$ の値を求めなさい。",
                        answer: "$\\frac{3}{5}$",
                        hint: "角度Aから見て、対辺と斜辺はどれでしょうか？",
                    },
                    {
                        question:
                            "直角三角形ABCで、$\\angle C = 90^\\circ$, AB=10, BC=6 のとき、$\\cos B$ の値を求めなさい。",
                        answer: "$\\frac{3}{5}$",
                        hint: "三平方の定理でACの長さを求め、角度Bから見て隣辺と斜辺を確認しましょう。",
                    },
                ]),
            },
            {
                title: "三角比の相互関係",
                explanation: `
  三角比には、いくつかの大事な関係式があります。
  ・$\\sin^2 \\theta + \\cos^2 \\theta = 1$
  ・$\\tan \\theta = \\sin \\theta ÷ \\cos \\theta$
  ・$1 + \\tan^2 \\theta = 1 ÷ \\cos^2 \\theta$

  これらを使うと、1つの三角比の値から他の三角比も計算できます。

  ポイント：
  ・関係式を覚えておくと計算が楽になる
  ・角度によって符号（プラス・マイナス）が変わることもあるので注意
`,
                pitfall: {
                    title: "よくある間違い：象限による符号の変化",
                    detail: `
三角比の相互関係を使う際、角度がどの象限にあるかによって、$\\sin \\theta$, $\\cos \\theta$, $\\tan \\theta$ の符号が変わることに注意が必要です。
例えば、$\\cos \\theta$ が負になる場合、$\\sin \\theta = \\sqrt{1 - \\cos^2 \\theta}$ ではなく、$\\sin \\theta = \\pm \\sqrt{1 - \\cos^2 \\theta}$ と考える必要があります。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "$\\sin \\theta = \\frac{3}{5}$ のとき、$\\cos \\theta$ の値を求めなさい。（ただし、$0^\\circ < \\theta < 90^\\circ$）",
                        answer: "$\\frac{4}{5}$",
                        hint: "$\\sin^2 \\theta + \\cos^2 \\theta = 1$ を使いましょう。",
                    },
                    {
                        question:
                            "$\\tan \\theta = 2$ のとき、$\\cos \\theta$ の値を求めなさい。（ただし、$0^\\circ < \\theta < 90^\\circ$）",
                        answer: "$\\frac{1}{\\sqrt{5}}$",
                        hint: "$1 + \\tan^2 \\theta = \\frac{1}{\\cos^2 \\theta}$ を使いましょう。",
                    },
                ]),
            },
            {
                title: "正弦定理・余弦定理",
                explanation: `
  「正弦定理」と「余弦定理」は、三角形の辺の長さや角度を求めるときに使う公式です。
  ・正弦定理：辺と向かい合う角のペアが分かっているとき
  ・余弦定理：2辺とその間の角、または3辺が分かっているとき

  直角三角形でなくても使えるので、いろいろな三角形の問題に役立ちます。

  ポイント：
  ・どちらの定理を使うか、問題文の条件で判断しよう
  ・公式を丸暗記するだけでなく、使い方も練習しよう
`,
                pitfall: {
                    title: "よくある間違い：どの定理を使うべきか判断できない",
                    detail: `
与えられた情報によって、正弦定理と余弦定理のどちらを使うべきか判断に迷うことがあります。
「向かい合う辺と角のペアが分かっている」場合は正弦定理、
「2辺とその間の角」または「3辺」が分かっている場合は余弦定理を使うことが多いです。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "三角形ABCで、b=4, $\\angle B = 30^\\circ$, $\\angle A = 45^\\circ$ のとき、辺aの長さを求めなさい。",
                        answer: "$4\\sqrt{2}$",
                        hint: "正弦定理を使いましょう。",
                    },
                    {
                        question:
                            "三角形ABCで、b=3, c=5, $\\angle A = 60^\\circ$ のとき、辺aの長さを求めなさい。",
                        answer: "$\\sqrt{19}$",
                        hint: "余弦定理を使いましょう。",
                    },
                ]),
            },
        ],
    },
    {
        topic: "データの分析",
        steps: [
            {
                title: "代表値と散らばり",
                explanation: `
  データの「代表値」には、平均値（みんなの合計を人数で割る）、中央値（真ん中の値）、最頻値（いちばん多い値）があります。

  「散らばり」を表すには、範囲（最大-最小）、四分位範囲、分散、標準偏差などがあります。

  これらを使うと、データの全体的な傾向やバラつきが分かります。

  ポイント：
  ・平均値は外れ値に弱い、中央値は外れ値に強い
  ・いろいろな指標を使い分けて、データを正しく読み取ろう
`,
                pitfall: {
                    title: "よくある間違い：中央値と平均値の使い分け",
                    detail: `
外れ値があるデータの場合、平均値は大きく影響を受けますが、中央値は影響を受けにくいです。
データの特性を理解し、適切な代表値を選ぶことが重要です。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "データ：2, 5, 3, 8, 2 の平均値を求めなさい。",
                        answer: "$4$",
                        hint: "すべての値を足して、データの個数で割りましょう。",
                    },
                    {
                        question:
                            "データ：2, 5, 3, 8, 2 の中央値を求めなさい。",
                        answer: "$3$",
                        hint: "データを小さい順に並べ替えて、真ん中の値を見つけましょう。",
                    },
                ]),
            },
            {
                title: "分散・標準偏差",
                explanation: `
分散と標準偏差は、データの散らばりの程度を数値で表す重要な指標です。

**分散**：
各データ値と平均値の差の2乗の平均
$s^2 = \\frac{1}{n}\\sum_{i=1}^{n}(x_i - \\bar{x})^2$

**標準偏差**：
分散の正の平方根
$s = \\sqrt{s^2} = \\sqrt{\\frac{1}{n}\\sum_{i=1}^{n}(x_i - \\bar{x})^2}$

**分散と標準偏差の性質**：
・常に0以上の値
・値が大きいほどデータの散らばりが大きい
・標準偏差は元のデータと同じ単位を持つ

**変動係数**：
$CV = \\frac{s}{\\bar{x}}$ （平均値に対する標準偏差の割合）

ポイント：
・分散は2乗の単位、標準偏差は元の単位
・外れ値の影響を受けやすい
・データの比較には変動係数が便利
`,
                pitfall: {
                    title: "よくある間違い：分散と標準偏差の単位の混同",
                    detail: `
分散は元のデータの単位の2乗になり、標準偏差は元のデータと同じ単位になります。
例えば、身長のデータ（cm）の場合、分散はcm²、標準偏差はcmの単位になります。
また、分散の計算では、平均値との差を2乗することを忘れがちです。
`,
                },
                problems: normalizeProblems([
                    {
                        question: "データ：1, 3, 5, 7, 9 の分散を求めなさい。",
                        answer: "$8$",
                        hint: "平均値は5、各値と平均値の差の2乗の平均を計算します。",
                    },
                    {
                        question: "データ：2, 4, 6, 8 の標準偏差を求めなさい。",
                        answer: "$\\sqrt{5}$",
                        hint: "まず分散を求め、その平方根を取ります。",
                    },
                ]),
            },
            {
                title: "散布図・相関係数",
                explanation: `
散布図と相関係数は、2つの変数の関係を分析する基本的な手法です。

**散布図**：
2つの変数の値を座標平面上にプロットしたグラフ
・正の相関：右上がりの傾向
・負の相関：右下がりの傾向
・無相関：点がばらばらに分布

**相関係数**：
2つの変数 $X$、$Y$ の相関係数 $r$ は
$r = \\frac{\\sum_{i=1}^{n} (x_i - \\bar{x})(y_i - \\bar{y})}{\\sqrt{\\sum_{i=1}^{n} (x_i - \\bar{x})^2} \\sqrt{\\sum_{i=1}^{n} (y_i - \\bar{y})^2}}$

**相関係数の性質**：
・$-1 \\le r \\le 1$
・$r = 1$：完全な正の相関
・$r = -1$：完全な負の相関
・$r = 0$：無相関

**相関の強さの目安**：
・$|r| \\ge 0.7$：強い相関
・$0.3 \\le |r| < 0.7$：中程度の相関
・$|r| < 0.3$：弱い相関

ポイント：
・相関は因果関係を意味しない
・外れ値の影響を受けやすい
・散布図と合わせて解釈することが重要
`,
                pitfall: {
                    title: "よくある間違い：相関と因果の混同",
                    detail: `
相関係数が高いからといって、必ずしも因果関係があるわけではありません。
例えば、アイスクリームの売上と溺死事故の数に正の相関があっても、
アイスクリームが溺死の原因とは限りません（気温が共通の要因の可能性）。
相関関係と因果関係は区別して考える必要があります。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "5組のデータ $(1,2), (2,4), (3,6), (4,8), (5,10)$ の相関係数を求めなさい。",
                        answer: "$1$",
                        hint: "完全な正の相関（直線関係）です。",
                    },
                    {
                        question:
                            "身長と体重の相関係数が0.8であった。この結果を解釈しなさい。",
                        answer: "身長と体重の間に強い正の相関がある。ただし、これは因果関係を意味するものではない。",
                        hint: "相関の強さと因果関係の区別について説明します。",
                    },
                ]),
            },
            {
                title: "仮説検定の考え方",
                explanation: `
仮説検定は、データに基づいて統計的な判断を行う基本的な考え方です。

**仮説検定の基本的な考え方**：
1. 帰無仮説（$H_0$）を設定する
2. 対立仮説（$H_1$）を設定する
3. 有意水準（$\\alpha$）を決める
4. 検定統計量を計算する
5. 結果を解釈する

**例：コイン投げの例**：
帰無仮説：コインは公平（表が出る確率 $p = 0.5$）
対立仮説：コインは不公平（$p \\neq 0.5$）

**p値の考え方**：
帰無仮説が正しいと仮定したとき、観測された結果以上に極端な結果が得られる確率

**有意水準**：
帰無仮説を棄却する基準となる確率（通常5%や1%）

**検定結果の解釈**：
・p値 < 有意水準：帰無仮説を棄却
・p値 ≥ 有意水準：帰無仮説を棄却できない

ポイント：
・「棄却できない」≠「正しい」
・検定結果は確率的な判断
・サンプルサイズの影響を考慮
・複数の検定の組み合わせに注意
`,
                pitfall: {
                    title: "よくある間違い：検定結果の誤解釈",
                    detail: `
仮説検定では、「帰無仮説を棄却できない」ことと「帰無仮説が正しい」ことを混同しがちです。
また、p値は「帰無仮説が正しい確率」ではなく、「帰無仮説が正しいと仮定したときの確率」です。
検定結果は、標本データに基づく判断であり、絶対的な真実ではありません。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "コインを10回投げて、表が8回出た。このコインが公平かどうかを検討しなさい。",
                        answer: "表が8回出る確率は約$4.4\\%$で、$5\\%$の有意水準では帰無仮説（公平）を棄却できる。",
                        hint: "二項分布 $B(10, 0.5)$ で $P(X \\ge 8)$ を計算します。",
                    },
                    {
                        question:
                            "ある薬の効果を調べるため、100人中60人が改善した。この薬に効果があるかどうかを検討しなさい。",
                        answer: "改善率$60\\%$は期待値$50\\%$と比較して有意差がある可能性がある。詳細な検定が必要。",
                        hint: "帰無仮説：改善率 $p = 0.5$ を検定します。",
                    },
                ]),
            },
        ],
    },
];

// 数学A の学習コンテンツ（新課程対応）
const mathALessons: LearningTopic[] = [
    {
        topic: "場合の数と確率",
        steps: [
            {
                title: "順列と組み合わせ",
                explanation: `
  「順列」とは、いくつかのものを「順番に並べる」場合の数です。
  たとえば、5人から3人を選んで並べるとき、並び方が違えば別のものと数えます。
  $P(n, r)$ という記号で表します。

  「組み合わせ」とは、いくつかのものを「順番を気にせずに選ぶ」場合の数です。
  たとえば、5人から3人を選ぶとき、誰を選ぶかだけを考え、並び順は関係ありません。
  $C(n, r)$ という記号で表します。

  ポイント：
  ・順列は「並べる順番が大事」
  ・組み合わせは「順番は関係ない」
  ・問題文の「並べる」「選ぶ」に注目しよう！
`,
                pitfall: {
                    title: "よくある間違い：順列と組み合わせの混同",
                    detail: `
問題文で「並べる」「順番に」といった言葉があれば順列、「選ぶ」「グループを作る」といった言葉があれば組み合わせです。
どちらを使うべきか、慎重に判断しましょう。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "5人の中から3人を選んで1列に並べる方法は何通りありますか？",
                        answer: "$60$",
                        hint: "これは順列の計算です。",
                    },
                    {
                        question:
                            "5人の中から3人の委員を選ぶ方法は何通りありますか？",
                        answer: "$10$",
                        hint: "これは組み合わせの計算です。",
                    },
                ]),
            },
            {
                title: "確率の基本法則",
                explanation: `
  「確率」とは、ある出来事が起こる「可能性の大きさ」を表す数です。
  確率は「起こる場合の数 ÷ 全部の場合の数」で計算します。

  「和の法則」は「どちらか一方が起こる場合の数」を足し算で求めます。
  「積の法則」は「両方が同時に起こる場合の数」を掛け算で求めます。

  ポイント：
  ・確率は「全部の場合の数」をしっかり数える
  ・和の法則は「または」、積の法則は「かつ」
  ・サイコロや玉の問題でよく使うので、練習しよう！
`,
                pitfall: {
                    title: "よくある間違い：排反事象と独立事象の混同",
                    detail: `
排反事象は「同時に起こらない事象」であり、独立事象は「一方の事象が他方の事象に影響を与えない」事象です。
それぞれの定義を理解し、適切な法則を適用しないと、確率の計算を間違えてしまいます。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "1個のサイコロを投げるとき、偶数の目が出る確率を求めなさい。",
                        answer: "$\\frac{1}{2}$",
                        hint: "偶数の目はいくつありますか？",
                    },
                    {
                        question:
                            "袋の中に赤玉3個、白玉2個が入っている。この袋から玉を1個取り出し、色を確認して元に戻す。これを2回繰り返すとき、2回とも赤玉が出る確率を求めなさい。",
                        answer: "$\\frac{9}{25}$",
                        hint: "1回目と2回目は独立な事象です。",
                    },
                ]),
            },
            {
                title: "期待値",
                explanation: `
期待値は、確率変数が取る値の平均的な大きさを表す概念です。

**期待値の定義**：
確率変数 $X$ が値 $x_1, x_2, ..., x_n$ を確率 $p_1, p_2, ..., p_n$ で取るとき、
期待値 $E[X] = x_1 p_1 + x_2 p_2 + \\cdots + x_n p_n$

**期待値の性質**：
・$E[aX + b] = aE[X] + b$ （線形性）
・$E[X + Y] = E[X] + E[Y]$ （加法性）
・独立な確率変数 $X, Y$ に対して $E[XY] = E[X]E[Y]$

**期待値の応用**：
・ゲームの公平性の判断
・投資の収益率の予測
・保険料の算定
・品質管理での不良品の予測

ポイント：
・期待値は「長期的な平均値」
・確率と値の積の和で計算
・線形性を活用して計算を簡略化
`,
                pitfall: {
                    title: "よくある間違い：期待値と最頻値の混同",
                    detail: `
期待値は確率で重み付けした平均値であり、必ずしも実際に観測される値ではありません。
また、期待値と最頻値（最も確率の高い値）は異なる概念です。期待値の計算では、
各値に確率を掛けて足し合わせることを忘れがちです。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "1個のサイコロを投げて出た目の期待値を求めなさい。",
                        answer: "$3.5$",
                        hint: "$E[X] = 1 \\times \\frac{1}{6} + 2 \\times \\frac{1}{6} + \\cdots + 6 \\times \\frac{1}{6}$",
                    },
                    {
                        question:
                            "袋の中に赤玉3個（1点）、白玉2個（2点）が入っている。玉を1個取り出したときの得点の期待値を求めなさい。",
                        answer: "$\\frac{7}{5}$",
                        hint: "$E[X] = 1 \\times \\frac{3}{5} + 2 \\times \\frac{2}{5}$",
                    },
                ]),
            },
        ],
    },
    {
        topic: "図形の性質",
        steps: [
            {
                title: "三角形の性質",
                explanation: `
三角形には様々な重要な性質があります。

**三角形の合同条件**：
1. 3辺がそれぞれ等しい
2. 2辺とその間の角が等しい
3. 1辺とその両端の角が等しい

**三角形の相似条件**：
1. 3辺の比が等しい
2. 2辺の比とその間の角が等しい
3. 2角が等しい

**三角形の重心・内心・外心・垂心**：
・重心：3つの中線の交点
・内心：3つの角の二等分線の交点（内接円の中心）
・外心：3つの辺の垂直二等分線の交点（外接円の中心）
・垂心：3つの頂点から対辺に引いた垂線の交点

ポイント：
・合同と相似の条件を正確に覚える
・特殊な点の性質を理解する
・図を描いて確認することが重要
`,
                graphs: [
                    {
                        type: "triangle",
                        params: {
                            points: [
                                [0, 0],
                                [3, 0],
                                [1.5, 2.5],
                            ],
                        },
                        style: { strokeColor: "#0074D9" },
                        description: "三角形ABCの基本形",
                    },
                    {
                        type: "triangle",
                        params: {
                            points: [
                                [0, 0],
                                [6, 0],
                                [3, 5],
                            ],
                            similarity: true,
                        },
                        style: { strokeColor: "#2ECC40" },
                        description: "相似な三角形DEF",
                    },
                    {
                        type: "centroid",
                        params: {
                            points: [
                                [0, 0],
                                [3, 0],
                                [1.5, 2.5],
                            ],
                        },
                        style: { strokeColor: "#FF4136" },
                        description: "三角形の重心",
                    },
                    {
                        type: "incenter",
                        params: {
                            points: [
                                [0, 0],
                                [3, 0],
                                [1.5, 2.5],
                            ],
                        },
                        style: { strokeColor: "#B10DC9" },
                        description: "三角形の内心",
                    },
                    {
                        type: "circumcenter",
                        params: {
                            points: [
                                [0, 0],
                                [3, 0],
                                [1.5, 2.5],
                            ],
                        },
                        style: { strokeColor: "#FF851B" },
                        description: "三角形の外心",
                    },
                    {
                        type: "orthocenter",
                        params: {
                            points: [
                                [0, 0],
                                [3, 0],
                                [1.5, 2.5],
                            ],
                        },
                        style: { strokeColor: "#001f3f" },
                        description: "三角形の垂心",
                    },
                ],
                pitfall: {
                    title: "よくある間違い：合同条件と相似条件の混同",
                    detail: `
合同条件と相似条件は似ていますが、合同は「完全に同じ形と大きさ」、相似は「同じ形で大きさが異なる」ことを意味します。
また、三角形の特殊な点（重心、内心など）の性質を混同しがちです。それぞれの定義と性質を正確に理解しましょう。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "三角形ABCで、AB=5、BC=6、CA=7のとき、この三角形の面積をヘロンの公式を使って求めなさい。",
                        answer: "$6\\sqrt{6}$",
                        hint: "ヘロンの公式：$S = \\sqrt{s(s-a)(s-b)(s-c)}$ ただし $s = \\frac{a+b+c}{2}$",
                    },
                    {
                        question:
                            "直角三角形ABC（∠C=90°）で、AB=5、BC=3のとき、ACの長さを求めなさい。",
                        answer: "$4$",
                        hint: "三平方の定理を使います。",
                    },
                ]),
            },
            {
                title: "円の性質",
                explanation: `
円には多くの美しい性質があります。

**円周角の定理**：
同じ弧に対する円周角は等しい。また、中心角は円周角の2倍。

**接線の性質**：
・接線は接点を通る半径に垂直
・接点から円外の点に引いた2本の接線の長さは等しい

**方べきの定理**：
点Pから円に引いた2本の直線が円と交わる点をA、B、C、Dとすると、
$PA \\times PB = PC \\times PD$

**円に内接する四角形**：
・対角の和は180°
・外角は対角に等しい

ポイント：
・円周角と中心角の関係を理解
・接線の性質を活用
・方べきの定理の適用場面を把握
`,
                pitfall: {
                    title: "よくある間違い：円周角と中心角の関係の誤解",
                    detail: `
円周角の定理では、同じ弧に対する円周角が等しいことを忘れがちです。
また、中心角が円周角の2倍であることを逆に解釈してしまうことがあります。
円に内接する四角形の性質も、対角の和が180°であることを忘れがちです。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "円Oの周上の点A、B、Cについて、∠AOB=80°のとき、∠ACBを求めなさい。",
                        answer: "$40°$",
                        hint: "中心角は円周角の2倍です。",
                    },
                    {
                        question:
                            "円に内接する四角形ABCDで、∠A=70°、∠B=110°のとき、∠Cを求めなさい。",
                        answer: "$70°$",
                        hint: "円に内接する四角形の対角の和は180°です。",
                    },
                ]),
            },
        ],
    },
    {
        topic: "数学と人間の活動",
        steps: [
            {
                title: "整数の性質",
                explanation: `
整数には様々な興味深い性質があります。

**約数と倍数**：
・約数：ある数を割り切ることができる整数
・倍数：ある数を何回か足したり掛けたりしてできる数
・最大公約数：2つ以上の数の共通の約数の中で一番大きいもの
・最小公倍数：2つ以上の数の共通の倍数の中で一番小さいもの

**ユークリッドの互除法**：
2つの自然数の最大公約数を求める方法
$a = bq + r$ のとき、$\\gcd(a,b) = \\gcd(b,r)$

**素因数分解**：
自然数を素数の積で表すこと
例：$60 = 2^2 \\times 3 \\times 5$

**整数の性質の応用**：
・暗号理論
・コンピュータ科学
・数論

ポイント：
・約数と倍数の関係を理解
・ユークリッドの互除法の原理を把握
・素因数分解の一意性を理解
`,
                pitfall: {
                    title: "よくある間違い：最大公約数と最小公倍数の計算ミス",
                    detail: `
最大公約数と最小公倍数の計算では、素因数分解を正確に行うことが重要です。
また、ユークリッドの互除法を使う際は、余りが0になるまで繰り返すことを忘れがちです。
素因数分解では、同じ素数が複数回現れる場合の指数の扱いに注意が必要です。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "84と120の最大公約数をユークリッドの互除法を使って求めなさい。",
                        answer: "$12$",
                        hint: "$120 = 84 \\times 1 + 36$、$84 = 36 \\times 2 + 12$、$36 = 12 \\times 3 + 0$",
                    },
                    {
                        question: "60の正の約数の個数を求めなさい。",
                        answer: "$12$",
                        hint: "$60 = 2^2 \\times 3 \\times 5$ より、$(2+1)(1+1)(1+1) = 12$",
                    },
                ]),
            },
            {
                title: "数学文化との関わり",
                explanation: `
数学は人類の文化と深く結びついて発展してきました。

**古代数学の歴史**：
・エジプト：ピラミッド建設と幾何学
・バビロニア：60進法と天文学
・ギリシャ：ユークリッド幾何学と論証数学
・インド：0の発見と代数学

**数学の発展と社会**：
・航海術と三角法
・産業革命と微積分
・コンピュータと離散数学
・インターネットと暗号理論

**数学の美しさ**：
・黄金比とフィボナッチ数列
・オイラーの公式：$e^{i\\pi} + 1 = 0$
・フラクタル図形
・対称性と群論

**現代社会での数学**：
・AI・機械学習
・金融・保険
・医療・薬学
・環境科学

ポイント：
・数学は人類の知的財産
・文化と社会の発展に貢献
・美しさと実用性の両立
・継続的な発展と革新
`,
                pitfall: {
                    title: "よくある間違い：数学の歴史的発展の誤解",
                    detail: `
数学の発展は直線的ではなく、様々な文化圏で並行して進んできました。
また、現代の数学的概念が古代から存在していたわけではなく、
時代とともに概念が洗練されてきたことを理解することが重要です。
数学の美しさは、抽象性と具体性のバランスにあることを忘れがちです。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "黄金比 $\\phi = \\frac{1+\\sqrt{5}}{2}$ の近似値を求めなさい。",
                        answer: "$1.618$",
                        hint: "$\\sqrt{5} \\approx 2.236$ を使います。",
                    },
                    {
                        question: "フィボナッチ数列の第10項を求めなさい。",
                        answer: "$55$",
                        hint: "$F_1=1, F_2=1, F_n=F_{n-1}+F_{n-2}$ で計算します。",
                    },
                ]),
            },
        ],
    },
];

// 数学II の学習コンテンツ
const math2Lessons: LearningTopic[] = [
    {
        topic: "式と証明",
        steps: [
            {
                title: "整式の除法と分数式",
                explanation: `
  「整式の除法」とは、xの式（多項式）を別の多項式で割る計算です。
  筆算のように、次数（xの何乗か）をそろえて計算します。

  「分数式」は、分母や分子にxの式がある分数のことです。
  分母・分子を同じ式で割ったり、通分したりして計算します。

  ポイント：
  ・割り算は筆算のイメージで
  ・分数式は通分や約分をしっかり
`,
                pitfall: {
                    title: "よくある間違い：整式の除法の筆算ミス",
                    detail: `
整式の除法では、各項の次数を揃えて計算すること、引き算の符号ミスに注意が必要です。
分数式では、通分する際に分母・分子に同じものを掛けること、約分する際に共通因数で割ることなどを忘れないようにしましょう。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "$(x^2 + 3x + 2)$ を $(x+1)$ で割ると、商は $x+2$、余りは $0$ です。",
                        answer: "商: $x^2-x+2$, 余り: $1$",
                        hint: "筆算で計算してみましょう。",
                    },
                    {
                        question:
                            "$\\frac{1}{x} + \\frac{1}{x+1} = \\frac{x+1}{x(x+1)} + \\frac{x}{x(x+1)} = \\frac{2x+1}{x(x+1)}$",
                        answer: "$2x/(x^2-1)$",
                        hint: "通分しましょう。",
                    },
                ]),
            },
            {
                title: "恒等式と等式・不等式の証明",
                explanation: `
  「恒等式」とは、どんなxを入れても必ず成り立つ式のことです。
  たとえば、x(x+1) = x^2 + x のような式です。

  等式や不等式の証明では、
  ・片方の式を変形してもう一方と同じにする
  ・両辺をそれぞれ変形して同じ式にする
  などの方法があります。

  不等式の証明では、$(A-B)$ が $0$ 以上になることを示したり、平均の性質を使ったりします。

  ポイント：
  ・恒等式は「いつでも成り立つ」式
  ・証明は式変形の練習！
`,
                pitfall: {
                    title: "よくある間違い：恒等式と方程式の混同",
                    detail: `
恒等式は「常に成り立つ」式であり、方程式は「特定の文字の値で成り立つ」式です。
恒等式の証明では、係数比較法や数値代入法が有効です。
不等式の証明では、二乗の形や正負の判断が重要になります。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "次の等式が恒等式となるように、定数a, bの値を求めなさい。$(a+b)x + (a-b) = 4x - 2$",
                        answer: "$a=1, b=3$",
                        hint: "係数比較法を使いましょう。",
                    },
                    {
                        question:
                            "$a>0, b>0$ のとき、$\\frac{a+b}{2} \\ge \\sqrt{ab}$ を証明しなさい。",
                        answer: `
1. まず、$\\frac{a+b}{2} - \\sqrt{ab}$ が0以上であることを示します。
   \\[
   \\frac{a+b}{2} - \\sqrt{ab} = \\frac{a+b - 2\\sqrt{ab}}{2}
   \\]
2. 分子 $a+b - 2\\sqrt{ab}$ を変形します。ここで、$a = (\\sqrt{a})^2$、$b = (\\sqrt{b})^2$ と考えると、分子は以下のように書き換えられます。
   \\[
   a+b - 2\\sqrt{ab} = (\\sqrt{a})^2 - 2\\sqrt{a}\\sqrt{b} + (\\sqrt{b})^2
   \\]
3. これは、$(x-y)^2 = x^2 - 2xy + y^2$ の形をしているため、次のように因数分解できます。
   \\[
   (\\sqrt{a})^2 - 2\\sqrt{a}\\sqrt{b} + (\\sqrt{b})^2 = (\\sqrt{a} - \\sqrt{b})^2
   \\]
4. したがって、元の式は以下のようになります。
   \\[
   \\frac{a+b}{2} - \\sqrt{ab} = \\frac{(\\sqrt{a} - \\sqrt{b})^2}{2}
   \\]
5. 実数である$\\sqrt{a}$と$\\sqrt{b}$に対して、$(\\sqrt{a} - \\sqrt{b})^2$ は**常に0以上**です。また、分母の2は正の数です。よって、
   \\[
   \\frac{(\\sqrt{a} - \\sqrt{b})^2}{2} \\ge 0
   \\]
   が成り立ちます。
6. これにより、$\\frac{a+b}{2} - \\sqrt{ab} \\ge 0$ となり、$\\frac{a+b}{2} \\ge \\sqrt{ab}$ が証明されました。

**等号成立条件**
等号が成立するのは、$\\frac{(\\sqrt{a} - \\sqrt{b})^2}{2} = 0$ のとき、すなわち $(\\sqrt{a} - \\sqrt{b})^2 = 0$ のときです。
これは $\\sqrt{a} - \\sqrt{b} = 0$、つまり $\\sqrt{a} = \\sqrt{b}$ のときであり、**$a=b$** のときに限られます。
`,
                        hint: "両辺を二乗して差を考えてみましょう。",
                    },
                ]),
            },
        ],
    },
    {
        topic: "高次方程式",
        steps: [
            {
                title: "複素数と2次方程式の解",
                explanation: `
  「複素数」とは、実数では解けない方程式（例：$x^2+1=0$）を解くために考えられた新しい数です。
  虚数単位 $i$（$i^2=-1$）を使って、$a+bi$ の形で表します。

  2次方程式の解は、判別式がマイナスでも複素数の範囲で2つ出せます。

  ポイント：
  ・$i^2 = -1$ をしっかり覚えよう
  ・複素数は「実数＋虚数」の形
`,
                pitfall: {
                    title: "よくある間違い：虚数単位の計算ミス",
                    detail: `
$i^2 = -1$ であることを常に意識しましょう。
複素数の足し算・引き算は実部と虚部をそれぞれ計算し、掛け算は分配法則で展開してから $i^2 = -1$ を適用します。
`,
                },
                problems: normalizeProblems([
                    {
                        question: "$(2+3i) + (1-i)$ を計算しなさい。",
                        answer: "$3+2i$",
                        hint: "実部と虚部をそれぞれ足し合わせましょう。",
                    },
                    {
                        question: "$(1+i)^2$ を計算しなさい。",
                        answer: "$2i$",
                        hint: "展開してから $i^2 = -1$ を使いましょう。",
                    },
                ]),
            },
            {
                title: "因数定理と高次方程式",
                explanation: `
  「因数定理」は、多項式 $P(x)$ が $(x-k)$ で割り切れるとき、$P(k)=0$ になるという定理です。
  これを使うと、3次や4次など高い次数の方程式の解を見つけやすくなります。

  $P(k)=0$ になる $k$ を見つけたら、$(x-k)$ で割って次数を下げていきます。

  ポイント：
  ・定数項の約数を代入してみると効率的
  ・割り算と因数分解を組み合わせて使う
`,
                pitfall: {
                    title: "よくある間違い：試行錯誤の範囲",
                    detail: `
$P(k)=0$ となる $k$ を見つける際、闇雲に数を代入するのではなく、定数項の約数を試すのが効率的です。
例えば、$x^3 + ax^2 + bx + c = 0$ の場合、$c$ の約数（正負両方）を試してみましょう。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "多項式 $P(x) = x^3 - 2x^2 - 5x + 6$ が $x-1$ で割り切れるか調べなさい。",
                        answer: "割り切れる",
                        hint: "$P(1)$ の値を計算してみましょう。",
                    },
                    {
                        question:
                            "方程式 $x^3 - 3x^2 + 4 = 0$ の解を求めなさい。",
                        answer: "$x=-1,2$（重解）",
                        hint: "定数項4の約数から解を探し、因数分解しましょう。",
                    },
                ]),
            },
        ],
    },
    {
        topic: "図形と方程式",
        steps: [
            {
                title: "点と直線",
                explanation: `
  「点と直線」の問題では、座標平面上の2点間の距離や、直線の傾き・方程式を学びます。
  2点間の距離は「三平方の定理」を使って計算します。

  直線の方程式には、$y=mx+n$（傾きと切片）や、$y-y1=m(x-x1)$（点と傾き）などいろいろな形があります。

  ポイント：
  ・距離は「三平方の定理」
  ・傾きは「$y$ の変化÷$x$ の変化」
  ・直線の式の形を覚えよう
`,
                pitfall: {
                    title: "よくある間違い：傾きの計算ミス",
                    detail: `
傾きは $\\frac{yの変化量}{xの変化量}$ です。
計算の際、分子と分母の引き算の順序を間違えないように注意しましょう。
また、垂直な2直線の傾きの積は $-1$ になる性質も重要です。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "点A$(1,2)$ と点B$(4,6)$ の間の距離を求めなさい。",
                        answer: "$5$",
                        hint: "距離の公式を使いましょう。",
                    },
                    {
                        question:
                            "点$(2,3)$ を通り、傾きが $-2$ の直線の方程式を求めなさい。",
                        answer: "$y=-2x+7$",
                        hint: "点と傾きが分かっている直線の方程式の形を思い出しましょう。",
                    },
                ]),
            },
            {
                title: "円の方程式",
                explanation: `
  「円の方程式」は、中心と半径が分かれば $(x-a)^2+(y-b)^2=r^2$ の形で表せます。
  これは「中心からの距離が常に半径 $r$」という意味です。

  一般形（$x^2+y^2+lx+my+n=0$）は、平方完成して標準形に直すと中心と半径が分かります。

  ポイント：
  ・標準形の形を覚えよう
  ・平方完成で中心と半径を求める
`,
                pitfall: {
                    title: "よくある間違い：半径の二乗を忘れる",
                    detail: `
円の方程式の右辺は半径 $r$ ではなく $r^2$ です。
例えば、半径が3の円の方程式は $(x-a)^2 + (y-b)^2 = 9$ となります。
また、中心の座標の符号ミスにも注意しましょう。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "中心が $(1, -2)$、半径が $4$ の円の方程式を求めなさい。",
                        answer: "$(x-1)^2+(y+2)^2=16$",
                        hint: "円の方程式の標準形に当てはめましょう。",
                    },
                    {
                        question:
                            "方程式 $x^2 + y^2 - 6x + 2y + 6 = 0$ が表す円の中心の座標と半径を求めなさい。",
                        answer: "中心:$(3,-1)$, 半径:$2$",
                        hint: "平方完成して標準形に変形しましょう。",
                    },
                ]),
            },
        ],
    },
    {
        topic: "三角関数",
        steps: [
            {
                title: "三角関数の定義とグラフ",
                explanation: `
  「三角関数」は、単位円（半径 $1$ の円）を使って、角度と $x$・$y$ の関係を表す関数です。
  $\\sin \\theta$ は $y$ 座標、$\\cos \\theta$ は $x$ 座標、$\\tan \\theta$ は傾きとして考えられます。

  これらの関数は、一定の間隔で同じ形が繰り返される「周期的なグラフ」になります。

  ポイント：
  ・単位円でイメージしよう
  ・グラフの周期性に注目
`,
                pitfall: {
                    title: "よくある間違い：符号の取り違え",
                    detail: `
単位円のどの象限に角度があるかによって、$\\sin \\theta$, $\\cos \\theta$, $\\tan \\theta$ の符号が変わります。
これを間違えると、計算結果が大きく変わってしまいます。
`,
                },
                problems: normalizeProblems([
                    {
                        question: "$\\sin(\\frac{\\pi}{2})$ の値を求めなさい。",
                        answer: "$1$",
                        hint: "単位円上の点 $(0,1)$ を考えましょう。",
                    },
                    {
                        question: "関数 $y = \\sin x$ の周期を答えなさい。",
                        answer: "$2\\pi$",
                        hint: "グラフが繰り返される最小の区間です。",
                    },
                ]),
            },
            {
                title: "加法定理",
                explanation: `
  「加法定理」は、2つの角度の和や差の三角関数を、$\\sin$ や $\\cos$ で表す公式です。
  たとえば、$\\sin(\\alpha + \\beta)$ や $\\cos(\\alpha + \\beta)$ など。

  これを使うと、複雑な三角関数の計算や、倍角・半角の公式も導けます。

  ポイント：
  ・公式の形をしっかり覚えよう
  ・符号や $\\sin$ ・ $\\cos$ の組み合わせに注意
`,
                pitfall: {
                    title: "よくある間違い：符号や関数の混同",
                    detail: `
加法定理は公式が似ているため、符号や$\\sin$と$\\cos$の組み合わせを間違えやすいです。
語呂合わせ（例：「咲いたコスモス、コスモス咲いた」）などを活用して正確に覚えましょう。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "$\\sin(75^\\circ)$ の値を求めなさい。（ヒント：$75^\\circ = 45^\\circ + 30^\\circ$）",
                        answer: "$\\frac{\\sqrt{6}+\\sqrt{2}}{4}$",
                        hint: "$\\sin(\\alpha + \\beta)$ の公式を使います。",
                    },
                    {
                        question:
                            "$\\cos(15^\\circ)$ の値を求めなさい。（ヒント：$15^\\circ = 45^\\circ - 30^\\circ$）",
                        answer: "$\\frac{\\sqrt{6}+\\sqrt{2}}{4}$",
                        hint: "$\\cos(\\alpha - \\beta)$ の公式を使います。",
                    },
                ]),
            },
        ],
    },
    {
        topic: "指数関数と対数関数",
        steps: [
            {
                title: "指数関数",
                explanation: `
  「指数関数」は、$y=a^x$ の形の関数です。
  $a$ が $1$ より大きいと右上がり、$0$ より小さいと右下がりのグラフになります。

  計算には「指数法則」（$a^m \\times a^n = a^{m+n}$ など）を使います。

  ポイント：
  ・指数法則をしっかり覚えよう
  ・グラフの形（増加・減少）をイメージ
`,
                pitfall: {
                    title: "よくある間違い：指数法則の適用ミス",
                    detail: `
特に、$(a^m)^n = a^{mn}$ と $a^m a^n = a^{m+n}$ の使い分けを間違えやすいです。
また、負の指数 ($a^{-n} = \\frac{1}{a^n}$) や分数指数 ($a^{\\frac{1}{n}} = \\sqrt[n]{a}$) の計算も重要です。
`,
                },
                problems: normalizeProblems([
                    {
                        question: "$2^3 \\times 2^4$ を計算しなさい。",
                        answer: "$128$",
                        hint: "指数法則 $a^m a^n = a^{m+n}$ を使いましょう。",
                    },
                    {
                        question: "$(3^2)^3$ を計算しなさい。",
                        answer: "$729$",
                        hint: "指数法則 $(a^m)^n = a^{mn}$ を使いましょう。",
                    },
                ]),
            },
            {
                title: "対数関数",
                explanation: `
  「対数関数」は、指数関数の逆で「$a$ を何回かけたら $x$ になるか」を表す関数です。
  たとえば、$\\log_2 8=3$ は「$2$ を $3$ 回かけると $8$ になる」という意味です。

  計算には「対数法則」（足し算が掛け算、引き算が割り算になるなど）を使います。

  ポイント：
  ・対数の意味をイメージしよう
  ・法則を使いこなすと計算が楽になる
`,
                pitfall: {
                    title: "よくある間違い：対数の定義と法則の混同",
                    detail: `
対数の定義（例：$\\log_2 8 = 3$ は $2^3 = 8$ を意味する）をしっかり理解することが重要です。
対数法則の適用も、足し算が掛け算に、引き算が割り算になるなど、指数法則と逆の関係にあることを意識しましょう。
`,
                },
                problems: normalizeProblems([
                    {
                        question: "$\\log_2 8$ の値を求めなさい。",
                        answer: "$3$",
                        hint: "2を何乗したら8になりますか？",
                    },
                    {
                        question:
                            "$\\log_{10} 2 + \\log_{10} 5$ を計算しなさい。",
                        answer: "$1$",
                        hint: "対数法則 $\\log_a M + \\log_a N = \\log_a MN$ を使いましょう。",
                    },
                ]),
            },
        ],
    },
    {
        topic: "微分法と積分法", // 数学IIの範囲での基本的な微分積分
        steps: [
            {
                title: "導関数 (基本的な多項式)",
                explanation: `
  「導関数」とは、関数の「変化の割合（傾き）」を表す新しい関数です。
  $x^n$ の微分は「$n$ を前に出して、$x$ の指数を1つ下げる」ルールで計算します。

  導関数を使うと、グラフの傾きや接線の式が分かります。

  ポイント：
  ・微分の公式を覚えよう
  ・導関数は「傾きの関数」
`,
                pitfall: {
                    title: "よくある間違い：定数項の微分",
                    detail: `
定数項（例：$x^2+5$ の $5$）を微分すると $0$ になります。
これを $1$ と間違えてしまうことが多いので注意しましょう。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "関数 $f(x) = x^3 - 4x^2 + 2x - 1$ を微分しなさい。",
                        answer: "$3x^2 - 8x + 2$",
                        hint: "各項を個別に微分しましょう。",
                    },
                    {
                        question: "関数 $g(x) = 5x^2 + 3$ を微分しなさい。",
                        answer: "$10x$",
                        hint: "定数項の微分に注意しましょう。",
                    },
                ]),
            },
            {
                title: "接線の方程式 (多項式)",
                explanation: `
  「接線の方程式」は、グラフ上のある点での「接する直線」の式です。
  まず導関数で傾きを求め、その点の座標と合わせて直線の式を作ります。

  $y-f(a)=f'(a)(x-a)$ の形を覚えておくと便利です。

  ポイント：
  ・傾きは導関数で求める
  ・点の座標と組み合わせて直線の式に
`,
                pitfall: {
                    title: "よくある間違い：接線の傾きと方程式の混同",
                    detail: `
$f'(a)$ は接線の「傾き」であり、方程式そのものではありません。
方程式を求める際には、点 $(a, f(a))$ も利用して、直線の式を完成させる必要があります。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "関数 $y = x^2 + 2x$ の $x=1$ における接線の方程式を求めなさい。",
                        answer: "$y=4x-1$",
                        hint: "まず$f'(x)$と$f'(1)$を求め、点$(1, f(1))$を通る直線を考えましょう。",
                    },
                    {
                        question:
                            "関数 $y = x^3 - 3x$ の $x=0$ における接線の方程式を求めなさい。",
                        answer: "$y=-3x$",
                        hint: "同様に$f'(x)$と$f'(0)$を求め、点$(0, f(0))$を通る直線を考えましょう。",
                    },
                ]),
            },
            {
                title: "不定積分 (基本的な多項式)",
                explanation: `
  「不定積分」とは、関数を「逆にたどる」計算です。
  $x^n$ の積分は「指数を1つ増やして、その数で割る」ルールで計算します。

  最後に「+C（積分定数）」を必ずつけましょう。

  ポイント：
  ・積分の公式を覚えよう
  ・+Cを忘れずに！
`,
                pitfall: {
                    title: "よくある間違い：積分定数Cの忘れ",
                    detail: `
不定積分では、積分定数 $C$ をつけ忘れると不正解になります。
これは、微分すると定数が消えてしまうため、元の関数にどのような定数があったか分からないからです。
`,
                },
                problems: normalizeProblems([
                    {
                        question: "$\\int (2x + 3) dx$ を求めなさい。",
                        answer: "$x^2+3x+C$",
                        hint: "各項を個別に積分し、積分定数Cをつけましょう。",
                    },
                    {
                        question: "$\\int (x^2 - 5x + 4) dx$ を求めなさい。",
                        answer: "$\\frac{1}{3} x^3 - \\frac{5}{2} x^2 + 4x + C$",
                        hint: "それぞれの項の指数に1を足し、その数で割りましょう。",
                    },
                ]),
            },
            {
                title: "定積分と面積 (多項式)",
                explanation: `
  「定積分」は、関数と $x$ 軸で囲まれた部分の「面積」を求める計算です。
  上端と下端の値を代入して引き算します。

  x軸より下の部分はマイナスになるので、面積を出すときは絶対値をとるか、符号に注意しましょう。

  ポイント：
  ・定積分は「面積」
  ・上端-下端で計算
  ・符号や絶対値に注意
`,
                pitfall: {
                    title: "よくある間違い：x軸より下の面積の符号",
                    detail: `
面積は常に正の値です。関数がx軸の下にある区間では、定積分の値は負になります。
この場合、その区間の定積分の値に絶対値をつけるか、$-f(x)$ を積分するようにしましょう。
`,
                },
                problems: normalizeProblems([
                    {
                        question: "$\\int_0^2 (x^2) dx$ を計算しなさい。",
                        answer: "$\\frac{8}{3}$",
                        hint: "まず不定積分を求め、その後で上端と下端の値を代入して引き算します。",
                    },
                    {
                        question:
                            "曲線 $y = x^2 - 1$ と $x$軸で囲まれた部分の面積を求めなさい。",
                        answer: "$\\frac{4}{3}$",
                        hint: "x軸との交点を求め、その区間で積分します。x軸より下の部分の符号に注意。",
                    },
                ]),
            },
        ],
    },
];

// 数学B の学習コンテンツ（新課程対応）
const mathBLessons: LearningTopic[] = [
    {
        topic: "数列",
        steps: [
            {
                title: "等差数列と等比数列",
                explanation: `
  「等差数列」とは、となり合う項の差がいつも同じ数列です。
  たとえば、$1, 3, 5, 7, ...$ のように、毎回同じ数だけ増えていきます。
  一般項は $a_n = a_1 + (n-1)d$ で表します。

  「等比数列」とは、となり合う項の比（わり算の結果）がいつも同じ数列です。
  たとえば、$2, 6, 18, 54, ...$ のように、毎回同じ数をかけていきます。
  一般項は $a_n = a_1 r^{n-1}$ で表します。

  ポイント：
  ・等差数列は「足し算・引き算」
  ・等比数列は「かけ算・わり算」
  ・公式の形をしっかり覚えよう！
`,
                pitfall: {
                    title: "よくある間違い：一般項の公式の混同",
                    detail: `
等差数列と等比数列の一般項の公式を混同しないように注意しましょう。
特に、等比数列の公比 $r$ の指数が $n-1$ であることを忘れないようにしましょう。
`,
                },
                problems: normalizeProblems([
                    {
                        question: "初項3、公差2の等差数列の第5項を求めなさい。",
                        answer: "$11$",
                        hint: "等差数列の一般項の公式に当てはめましょう。",
                    },
                    {
                        question: "初項2、公比3の等比数列の第4項を求めなさい。",
                        answer: "$54$",
                        hint: "等比数列の一般項の公式に当てはめましょう。",
                    },
                ]),
            },
            {
                title: "数列の和 (Σ記号)",
                explanation: `
  数列の各項を足し合わせたものを数列の和と呼び、Σ（シグマ）記号を使って表します。
  等差数列の和の公式：$S_n = \\frac{n(a_1 + a_n)}{2}$ または $S_n = \\frac{n(2a_1 + (n-1)d)}{2}$
  等比数列の和の公式：$S_n = \\frac{a_1(r^n - 1)}{r-1}$ （$r \\neq 1$ のとき）
  Σ記号の計算では、公式や性質を正しく適用することが重要です。
`,
                pitfall: {
                    title: "よくある間違い：Σ記号の範囲と変数",
                    detail: `
Σ記号の上下に書かれている添字の範囲を正確に把握しましょう。
また、Σ記号の右にある式が、どの変数（例：$k$）に依存しているかを確認し、それ以外の文字は定数として扱うことに注意しましょう。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "初項1、末項10、項数10の等差数列の和を求めなさい。",
                        answer: "$55$",
                        hint: "等差数列の和の公式を使いましょう。",
                    },
                    {
                        question: "$\\sum_{k=1}^{n} k$ の公式を答えなさい。",
                        answer: "$\\frac{n(n+1)}{2}$",
                        hint: "自然数の和の公式です。",
                    },
                ]),
            },
            {
                title: "漸化式",
                explanation: `
  「漸化式」とは、数列の各項を、その前の項やいくつかの前の項を使って表す式です。
  例えば、等差数列は $a_{n+1} = a_n + d$、等比数列は $a_{n+1} = r a_n$ と表せます。
  漸化式を解くことで、数列の一般項を求めることができます。
`,
                pitfall: {
                    title: "よくある間違い：漸化式のタイプの見分け方",
                    detail: `
漸化式にはいくつかの典型的なパターン（等差型、等比型、特性方程式を用いるものなど）があります。
与えられた漸化式がどのタイプに当てはまるかを見分け、適切な解法を適用することが重要です。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "$a_1 = 1, a_{n+1} = a_n + 3$ で定義される数列の一般項 $a_n$ を求めなさい。",
                        answer: "$3n-2$",
                        hint: "これは等差数列の漸化式です。",
                    },
                    {
                        question:
                            "$a_1 = 2, a_{n+1} = 2a_n$ で定義される数列の一般項 $a_n$ を求めなさい。",
                        answer: "$2^n$",
                        hint: "これは等比数列の漸化式です。",
                    },
                ]),
            },
            {
                title: "数学的帰納法",
                explanation: `
数学的帰納法は、自然数に関する命題を証明する強力な方法です。

数学的帰納法の手順：
1. **基底段階**：$n = 1$ のとき命題が成り立つことを示す
2. **帰納段階**：$n = k$ のとき命題が成り立つと仮定して、$n = k + 1$ のときも成り立つことを示す

これにより、すべての自然数 $n$ について命題が成り立つことが証明されます。

ポイント：
・基底段階と帰納段階の両方が必要
・帰納段階では「$n = k$ のとき命題が成り立つ」という仮定を活用
・式変形や計算を丁寧に行う
`,
                pitfall: {
                    title: "よくある間違い：帰納段階での仮定の活用不足",
                    detail: `
帰納段階では、「$n = k$ のとき命題が成り立つ」という仮定を必ず使う必要があります。
この仮定を使わずに証明しようとすると、数学的帰納法の証明として不十分になります。
また、基底段階を省略したり、帰納段階の論理が不正確だったりすることもよくある間違いです。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "数学的帰納法を使って、$1 + 2 + 3 + \\cdots + n = \\frac{n(n+1)}{2}$ を証明しなさい。",
                        answer: `
1. 基底段階：$n = 1$ のとき、左辺 = 1、右辺 = $\\frac{1 \\times 2}{2} = 1$ より成り立つ。

2. 帰納段階：$n = k$ のとき成り立つと仮定すると、
   $1 + 2 + 3 + \\cdots + k = \\frac{k(k+1)}{2}$
   
   $n = k + 1$ のとき、
   左辺 = $1 + 2 + 3 + \\cdots + k + (k+1) = \\frac{k(k+1)}{2} + (k+1) = \\frac{(k+1)(k+2)}{2}$
   右辺 = $\\frac{(k+1)((k+1)+1)}{2} = \\frac{(k+1)(k+2)}{2}$
   
   よって、$n = k + 1$ のときも成り立つ。

したがって、数学的帰納法により、すべての自然数 $n$ について命題が成り立つ。`,
                        hint: "帰納段階では仮定を使って式変形を行います。",
                    },
                    {
                        question:
                            "数学的帰納法を使って、$2^n > n$ を証明しなさい。",
                        answer: `
1. 基底段階：$n = 1$ のとき、$2^1 = 2 > 1$ より成り立つ。

2. 帰納段階：$n = k$ のとき成り立つと仮定すると、$2^k > k$
   
   $n = k + 1$ のとき、
   $2^{k+1} = 2 \\times 2^k > 2k \\ge k + 1$ （$k \\ge 1$ より）
   
   よって、$n = k + 1$ のときも成り立つ。

したがって、数学的帰納法により、すべての自然数 $n$ について命題が成り立つ。`,
                        hint: "帰納段階では $2^k > k$ の仮定を活用します。",
                    },
                ]),
            },
        ],
    },
    {
        topic: "統計的な推測",
        steps: [
            {
                title: "確率分布",
                explanation: `
確率分布は、確率変数がどのような値を取る確率かを表す関数です。

**二項分布**：
$n$ 回の独立な試行で、成功確率 $p$ の事象が $k$ 回起こる確率
$P(X = k) = {}_n C_k p^k (1-p)^{n-k}$

**正規分布**：
連続確率分布で、平均 $\\mu$、標準偏差 $\\sigma$ の正規分布 $N(\\mu, \\sigma^2)$
確率密度関数：$f(x) = \\frac{1}{\\sqrt{2\\pi}\\sigma} e^{-\\frac{(x-\\mu)^2}{2\\sigma^2}}$

正規分布の性質：
・平均を中心に左右対称
・68-95-99.7ルール：$\\mu \\pm \\sigma$ に約68%、$\\mu \\pm 2\\sigma$ に約95%、$\\mu \\pm 3\\sigma$ に約99.7%

ポイント：
・二項分布は離散分布、正規分布は連続分布
・正規分布は統計的推測の基礎
・標準正規分布 $N(0,1)$ の理解が重要
`,
                pitfall: {
                    title: "よくある間違い：分布の種類の混同",
                    detail: `
二項分布と正規分布は全く異なる性質を持ちます。二項分布は離散的な値を取り、
正規分布は連続的な値を取ります。また、正規分布の確率密度関数の積分が1になることを
忘れがちです。確率計算では、適切な分布を選択することが重要です。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "コインを10回投げて、表が3回出る確率を求めなさい。",
                        answer: "$\\frac{120}{1024} = \\frac{15}{128}$",
                        hint: "二項分布 $B(10, \\frac{1}{2})$ を使います。",
                    },
                    {
                        question:
                            "正規分布 $N(50, 25)$ において、$45 \\le X \\le 55$ となる確率を概算しなさい。",
                        answer: "約$68\\%$",
                        hint: "68-95-99.7ルールを使います。$\\sigma = 5$ なので、$50 \\pm 5$ の範囲です。",
                    },
                ]),
            },
            {
                title: "区間推定",
                explanation: `
区間推定は、母集団の未知のパラメータ（平均や比率など）を、信頼区間という形で推定する方法です。

**母平均の区間推定**：
母集団が正規分布 $N(\\mu, \\sigma^2)$ に従い、母標準偏差 $\\sigma$ が既知の場合
信頼度 $1-\\alpha$ の信頼区間：
$\\left[\\bar{x} - z_{\\alpha/2} \\frac{\\sigma}{\\sqrt{n}}, \\bar{x} + z_{\\alpha/2} \\frac{\\sigma}{\\sqrt{n}}\\right]$

ここで：
・$\\bar{x}$ は標本平均
・$n$ は標本サイズ
・$z_{\\alpha/2}$ は標準正規分布の上側 $\\alpha/2$ 点

**母比率の区間推定**：
信頼度 $1-\\alpha$ の信頼区間：
$\\left[\\hat{p} - z_{\\alpha/2} \\sqrt{\\frac{\\hat{p}(1-\\hat{p})}{n}}, \\hat{p} + z_{\\alpha/2} \\sqrt{\\frac{\\hat{p}(1-\\hat{p})}{n}}\\right]$

ポイント：
・信頼度は「区間が真の値を含む確率」
・標本サイズが大きいほど信頼区間は狭くなる
・信頼度を高くすると信頼区間は広くなる
`,
                pitfall: {
                    title: "よくある間違い：信頼区間の解釈ミス",
                    detail: `
信頼区間は「真の値がこの区間に含まれる確率」ではなく、「この区間推定法を何度も繰り返したとき、
真の値を含む区間が得られる割合」を表します。また、母標準偏差が未知の場合は、
t分布を使う必要がありますが、標本サイズが大きい場合は正規分布で近似できます。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "正規分布に従う母集団から標本サイズ100、標本平均50、母標準偏差10の標本を抽出した。母平均の95%信頼区間を求めなさい。",
                        answer: "$[48.04, 51.96]$",
                        hint: "$z_{0.025} = 1.96$ を使います。",
                    },
                    {
                        question:
                            "ある選挙で1000人中600人が候補者Aを支持した。候補者Aの支持率の95%信頼区間を求めなさい。",
                        answer: "$[0.570, 0.630]$",
                        hint: "$\\hat{p} = 0.6$、$z_{0.025} = 1.96$ を使います。",
                    },
                ]),
            },
            {
                title: "仮説検定",
                explanation: `
仮説検定は、母集団に関する仮説が正しいかどうかを、標本データに基づいて判断する方法です。

**仮説検定の手順**：
1. 帰無仮説 $H_0$ と対立仮説 $H_1$ を設定
2. 有意水準 $\\alpha$ を決める（通常5%や1%）
3. 検定統計量を計算
4. 棄却域を決める
5. 検定統計量が棄却域に入るかどうかで判断

**母平均の検定**：
帰無仮説：$H_0: \\mu = \\mu_0$
検定統計量：$Z = \\frac{\\bar{x} - \\mu_0}{\\sigma/\\sqrt{n}}$ （母標準偏差既知の場合）

**母比率の検定**：
帰無仮説：$H_0: p = p_0$
検定統計量：$Z = \\frac{\\hat{p} - p_0}{\\sqrt{\\frac{p_0(1-p_0)}{n}}}$

**p値**：
帰無仮説が正しいと仮定したとき、観測された統計量以上に極端な値が得られる確率

ポイント：
・第1種の過誤（$H_0$ が正しいのに棄却）と第2種の過誤（$H_0$ が間違っているのに採択）がある
・p値が有意水準より小さいとき帰無仮説を棄却
・検定結果の解釈には注意が必要
`,
                pitfall: {
                    title: "よくある間違い：検定結果の解釈ミス",
                    detail: `
仮説検定では、「帰無仮説を棄却できない」ことと「帰無仮説が正しい」ことを混同しがちです。
また、p値は「帰無仮説が正しい確率」ではなく、「帰無仮説が正しいと仮定したときの確率」です。
検定結果は、標本データに基づく判断であり、絶対的な真実ではありません。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "ある工場の製品の重さは正規分布 $N(\\mu, 25)$ に従う。標本サイズ100、標本平均52の標本から、$H_0: \\mu = 50$ を有意水準5%で検定しなさい。",
                        answer: "検定統計量 $Z = \\frac{52-50}{5/\\sqrt{100}} = 4$、$|Z| > 1.96$ より帰無仮説を棄却",
                        hint: "両側検定で $z_{0.025} = 1.96$ と比較します。",
                    },
                    {
                        question:
                            "ある薬の効果を調べるため、100人中70人が改善した。$H_0: p = 0.5$ を有意水準5%で検定しなさい。",
                        answer: "検定統計量 $Z = \\frac{0.7-0.5}{\\sqrt{\\frac{0.5 \\times 0.5}{100}}} = 4$、$|Z| > 1.96$ より帰無仮説を棄却",
                        hint: "両側検定で $z_{0.025} = 1.96$ と比較します。",
                    },
                ]),
            },
        ],
    },
    {
        topic: "数学と社会生活",
        steps: [
            {
                title: "散布図と相関",
                explanation: `
散布図は、2つの変数の関係を視覚的に表現するグラフです。

**相関係数**：
2つの変数 $X$、$Y$ の相関係数 $r$ は
$r = \\frac{\\sum_{i=1}^{n} (x_i - \\bar{x})(y_i - \\bar{y})}{\\sqrt{\\sum_{i=1}^{n} (x_i - \\bar{x})^2} \\sqrt{\\sum_{i=1}^{n} (y_i - \\bar{y})^2}}$

相関係数の性質：
・$-1 \\le r \\le 1$
・$r = 1$：完全な正の相関
・$r = -1$：完全な負の相関
・$r = 0$：無相関

相関の解釈：
・$|r| \\ge 0.7$：強い相関
・$0.3 \\le |r| < 0.7$：中程度の相関
・$|r| < 0.3$：弱い相関

ポイント：
・相関は因果関係を意味しない
・外れ値の影響を受けやすい
・散布図と合わせて解釈することが重要
`,
                pitfall: {
                    title: "よくある間違い：相関と因果の混同",
                    detail: `
相関係数が高いからといって、必ずしも因果関係があるわけではありません。
例えば、アイスクリームの売上と溺死事故の数に正の相関があっても、
アイスクリームが溺死の原因とは限りません（気温が共通の要因の可能性）。
相関関係と因果関係は区別して考える必要があります。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "5組のデータ $(1,2), (2,4), (3,6), (4,8), (5,10)$ の相関係数を求めなさい。",
                        answer: "$1$",
                        hint: "完全な正の相関（直線関係）です。",
                    },
                    {
                        question:
                            "身長と体重の相関係数が0.8であった。この結果を解釈しなさい。",
                        answer: "身長と体重の間に強い正の相関がある。ただし、これは因果関係を意味するものではない。",
                        hint: "相関の強さと因果関係の区別について説明します。",
                    },
                ]),
            },
            {
                title: "社会的事象への応用",
                explanation: `
数学的手法は、様々な社会的事象の分析に応用できます。

**経済データの分析**：
・GDPと失業率の関係
・株価と為替レートの相関
・インフレ率と金利の関係

**環境データの分析**：
・気温と二酸化炭素濃度の関係
・降水量と農作物の収穫量
・大気汚染と健康指標

**医療データの分析**：
・薬の投与量と効果の関係
・年齢と血圧の相関
・運動時間と体重の関係

分析のポイント：
・データの質と信頼性を確認
・適切な統計手法を選択
・結果の解釈には慎重さが必要
・倫理的配慮を忘れない

ポイント：
・数学は社会問題の解決に役立つ
・データに基づく意思決定が重要
・批判的思考が求められる
`,
                pitfall: {
                    title: "よくある間違い：データの誤解釈",
                    detail: `
社会データの分析では、データの収集方法やサンプリングの偏りを考慮する必要があります。
また、統計的有意性と実用的な重要性は異なる概念です。小さな効果でも統計的に有意になる場合があり、
逆に大きな効果でも統計的に有意でない場合があります。結果の解釈には慎重さが必要です。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "ある地域の年齢と医療費の相関係数が0.9であった。この結果から何が言えるか。",
                        answer: "年齢と医療費の間に強い正の相関がある。ただし、年齢が医療費の原因とは限らない。",
                        hint: "相関関係と因果関係の区別について説明します。",
                    },
                    {
                        question:
                            "スマートフォンの使用時間と睡眠時間の相関係数が-0.6であった。この結果を解釈しなさい。",
                        answer: "スマートフォンの使用時間が長いほど睡眠時間が短い傾向がある。ただし、因果関係は不明。",
                        hint: "負の相関の意味と因果関係の区別について説明します。",
                    },
                ]),
            },
        ],
    },
];

// 数学III の学習コンテンツ (既存の微分積分コンテンツを再利用・一部追加)
const math3Lessons: LearningTopic[] = [
    {
        topic: "複素数平面",
        steps: [
            {
                title: "複素数と複素数平面",
                explanation: `
  「複素数」とは、$a+bi$ の形で表す数で、$a$ は実数、$bi$ は虚数です。
  複素数平面（ガウス平面）は、横軸が実数、縦軸が虚数として複素数を点で表します。
  複素数のたし算・ひき算は、ベクトルのように考えると分かりやすいです。

  ポイント：
  ・複素数は「実部＋虚部」
  ・平面上の点としてイメージしよう
`,
                pitfall: {
                    title: "よくある間違い：虚数と複素数の混同",
                    detail: `
虚数単位 $i$ を含む数を虚数と呼びますが、複素数 $a+bi$ のうち $b \\neq 0$ のものが虚数です。
$a=0$ の場合は純虚数と呼びます。
複素数平面上での点の位置と、その複素数の実部・虚部の対応を正確に理解しましょう。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "複素数 $3+4i$ を複素数平面上に図示しなさい。",
                        answer: "実軸$3$, 虚軸$4$ の点",
                        hint: "実部がx座標、虚部がy座標に対応します。",
                    },
                    {
                        question:
                            "複素数 $z = 1 + \\sqrt{3}i$ の絶対値 $|z|$ を求めなさい。",
                        answer: "$2$",
                        hint: "原点からの距離です。三平方の定理を使いましょう。",
                    },
                ]),
            },
            {
                title: "ド・モアブルの定理",
                explanation: `
  複素数を極形式 $z = r(\\cos \\theta + i \\sin \\theta)$ で表すと、
  $z^n = r^n (\\cos n\\theta + i \\sin n\\theta)$ という関係が成り立ちます。これがド・モアブルの定理です。
  この定理を使うと、複素数の累乗や、複素数の方程式の解を簡単に求めることができます。
`,
                pitfall: {
                    title: "よくある間違い：角度の計算ミス",
                    detail: `
ド・モアブルの定理を適用する際、角度 $\\theta$ を $n$ 倍することになります。
このとき、角度が $2\\pi$（または $360^\\circ$）を超える場合は、その周期性を考慮して角度を調整しましょう。
また、極形式への変換を正確に行うことが前提となります。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "$(\\cos \\theta + i \\sin \\theta)^3$ を計算しなさい。",
                        answer: "$\\cos(3\\theta)+i\\sin(3\\theta)$",
                        hint: "ド・モアブルの定理をそのまま適用しましょう。",
                    },
                    {
                        question: "$(1+i)^4$ を計算しなさい。",
                        answer: "$-4$",
                        hint: "まず $1+i$ を極形式に直し、その後ド・モアブルの定理を適用しましょう。",
                    },
                ]),
            },
        ],
    },
    {
        topic: "関数",
        steps: [
            {
                title: "いろいろな関数 (分数関数、無理関数など)",
                explanation: `
  数学IIIでは、分数関数 ($y = \\frac{P(x)}{Q(x)}$)、無理関数 ($y = \\sqrt{f(x)}$)、指数関数、対数関数、三角関数など、様々な種類の関数を学びます。
  それぞれの関数の定義域、値域、グラフの概形、漸近線などを理解することが重要です。
`,
                pitfall: {
                    title: "よくある間違い：定義域の確認不足",
                    detail: `
分数関数では分母が0になる点、無理関数では根号の中が負になる点など、関数が定義されない範囲があります。
これらの定義域を正確に把握しないと、グラフを描いたり、極限や微分を計算する際に間違いが生じます。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "関数 $y = \\frac{1}{x}$ の漸近線を求めなさい。",
                        answer: "$x=2, y=0$",
                        hint: "分母が0になる点と、xが無限大に近づくときのyの値を考えましょう。",
                    },
                    {
                        question:
                            "関数 $y = \\sqrt{x+1}$ の定義域を求めなさい。",
                        answer: "$x>=-1$",
                        hint: "根号の中は負にならないという条件を考えましょう。",
                    },
                ]),
            },
            {
                title: "逆関数と合成関数",
                explanation: `
  逆関数は、元の関数のxとyの役割を入れ替えた関数です。$y=f(x)$ の逆関数は $x=f(y)$ をyについて解いたものです。記号では $f^{-1}(x)$ と書きます。
  合成関数は、ある関数の結果を別の関数の入力として使う関数です。$f(g(x))$ や $g(f(x))$ のように表されます。
`,
                pitfall: {
                    title: "よくある間違い：逆関数の存在条件",
                    detail: `
逆関数が存在するのは、元の関数が1対1の対応である（単調増加または単調減少）場合のみです。
例えば、$y=x^2$ は逆関数を持ちません（定義域を制限すれば持つ）。
合成関数の順序も重要で、$f(g(x))$ と $g(f(x))$ は一般に異なります。
`,
                },
                problems: normalizeProblems([
                    {
                        question: "関数 $y = 2x - 1$ の逆関数を求めなさい。",
                        answer: "$y=\\frac{1}{2}x+\\frac{1}{2}$",
                        hint: "xとyを入れ替えてyについて解きましょう。",
                    },
                    {
                        question:
                            "関数 $f(x) = x+1$, $g(x) = x^2$ のとき、$f(g(x))$ を求めなさい。",
                        answer: "$x^2+1$",
                        hint: "$g(x)$ を $f(x)$ のxに代入しましょう。",
                    },
                ]),
            },
        ],
    },
    {
        topic: "極限", // トピック名
        steps: [
            {
                title: "極限の概念と表記", // ステップのタイトル
                explanation: `
  極限とは、関数がある値に限りなく近づくときの関数の値の振る舞いを表すものです。例えば、$x$が2に近づくとき、$x+1$は3に近づきます。これを$\\lim_{x \\to 2} (x+1) = 3$と表記します。
  「限りなく近づく」というのは、その値そのものになるわけではない、という点が重要です。
`,
                pitfall: {
                    // よくある間違いのセクション
                    title: "よくある間違い：極限と代入を混同する",
                    detail: `
極限は「限りなく近づく」ことであり、その値を「代入する」こととは異なります。
例えば、$\\lim_{x \\to 0} \\frac{x^2}{x}$ の場合、単純に$x=0$を代入すると$\\frac{0}{0}$となり計算できません。
しかし、この式は$x \\neq 0$のとき$\\frac{x^2}{x} = x$と簡略化できるため、$\\lim_{x \\to 0} x = 0$となります。
これは、$x$が0に限りなく近づくとき、関数$\\frac{x^2}{x}$の値は0に限りなく近づく、という意味です。
`,
                },
                problems: normalizeProblems([
                    // 練習問題
                    {
                        question:
                            "$\\lim_{x \\to 3} (2x - 1)$ の値を求めなさい。",
                        answer: "$5$",
                        hint: "関数に$x$の値を代入してみてください。",
                    },
                    {
                        question:
                            "$\\lim_{x \\to 1} (x^2 + 4)$ の値を求めなさい。",
                        answer: "$5$",
                        hint: "これも単純な代入で解けます。",
                    },
                ]),
            },
            {
                title: "極限の計算（多項式関数）",
                explanation: `
  多項式関数の極限は、基本的に$x$が近づく値を関数に代入することで求められます。
  例えば、$\\lim_{x \\to a} P(x) = P(a)$ となります。
`,
                pitfall: {
                    title: "よくある間違い：無限大の扱い",
                    detail: `
$x \\to \\infty$ (無限大) の極限を考える場合、単純な代入はできません。
例えば、$\\lim_{x \\to \\infty} (x^2 - x)$ の場合、$x^2$の方が$x$よりも速く増加するため、結果は$\\infty$となります。
最高次の項に注目するのがポイントです。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "$\\lim_{x \\to -2} (x^3 + 3x - 5)$ の値を求めなさい。",
                        answer: "$-19$",
                        hint: "多項式関数なので、直接代入して計算できます。",
                    },
                    {
                        question:
                            "$\\lim_{x \\to \\infty} (x^2 - 5x + 1)$ の値を求めなさい。",
                        answer: "$\\infty$", // 無限大は文字列として扱う
                        hint: "最高次の項の振る舞いを考えると良いでしょう。",
                    },
                ]),
            },
            {
                title: "極限の計算（分数関数）",
                explanation: `
  分数関数の極限では、分母が$0$になる場合に注意が必要です。
  分母が0になる場合、因数分解や有理化などの操作で式を簡略化してから極限を計算します。
`,
                pitfall: {
                    title: "よくある間違い：約分せずに代入する",
                    detail: `
$\\lim_{x \\to 2} \\frac{x^2 - 4}{x - 2}$ のような問題で、約分せずに$x=2$を代入すると$\\frac{0}{0}$となり、計算できません。
この場合、分子を因数分解して$\\frac{(x-2)(x+2)}{x-2}$とし、$x \\neq 2$のときに約分すると$x+2$になります。
したがって、$\\lim_{x \\to 2} (x+2) = 4$となります。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "$\\lim_{x \\to 1} \\frac{x^2 - 1}{x - 1}$ の値を求めなさい。",
                        answer: "$2$",
                        hint: "分子を因数分解して約分できます。",
                    },
                    {
                        question:
                            "$\\lim_{x \\to 0} \\frac{\\sqrt{x+1} - 1}{x}$ の値を求めなさい。（ヒント：有理化）",
                        answer: "$0.5$",
                        hint: "分母の有理化を試みてください。",
                    },
                ]),
            },
            {
                title: "関数の連続性",
                explanation: `
  関数$f(x)$が$x=a$で連続であるとは、以下の3つの条件が満たされることです。
  1. $f(a)$が存在する。
  2. $\\lim_{x \\to a} f(x)$が存在する。
  3. $\\lim_{x \\to a} f(x) = f(a)$ である。
  簡単に言えば、グラフが途切れていない状態です。
`,
                pitfall: {
                    title: "よくある間違い：グラフが途切れていれば不連続",
                    detail: `
連続性の定義は3つの条件全てを満たす必要があります。
例えば、関数が$x=a$で定義されていても、その点での極限値が存在しない場合や、極限値と関数値が一致しない場合は不連続です。
穴が開いているグラフや、ジャンプしているグラフは不連続です。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "関数 $f(x) = \\begin{cases} x+2 & (x \\neq 1) \\\\ 5 & (x = 1) \\end{cases}$ は $x=1$ で連続ですか？",
                        answer: "不連続",
                        hint: "xが1に近づくときの極限値と、x=1での関数値が一致するか確認しましょう。",
                    },
                    {
                        question:
                            "関数 $g(x) = x^2 - 3x + 2$ は全ての点で連続ですか？",
                        answer: "連続",
                        hint: "多項式関数は常に連続であることを思い出してください。",
                    },
                ]),
            },
        ],
    },
    {
        topic: "微分", // トピック名
        steps: [
            {
                title: "微分の定義と導関数",
                explanation: `
  微分とは、関数の変化の割合、つまり「傾き」を求めることです。
  特に、ある点における接線の傾きを求める操作です。
  関数$f(x)$の$x=a$における微分係数は、$\\lim_{h \\to 0} \\frac{f(a+h) - f(a)}{h}$ で定義されます。
  そして、この微分係数を$x$の関数として一般化したものが「導関数」で、$f'(x)$と書きます。
`,
                pitfall: {
                    title: "よくある間違い：微分係数と導関数の違い",
                    detail: `
微分係数は「特定の点における接線の傾き」という「値」です。
導関数は「任意の点における接線の傾きを表す関数」であり、「式」です。
混同しないように注意しましょう。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "関数 $f(x) = x^2$ の導関数を定義に基づいて求めなさい。",
                        answer: "$2x$",
                        hint: "微分の定義式に当てはめて計算してみましょう。",
                    },
                    {
                        question:
                            "関数 $f(x) = 3x + 1$ の導関数を定義に基づいて求めなさい。",
                        answer: "$3$",
                        hint: "微分の定義式を使います。直線の傾きを考えても良いでしょう。",
                    },
                ]),
            },
            {
                title: "基本的な微分公式",
                explanation: `
  毎回定義を使って微分するのは大変なので、便利な公式があります。
  1. $C$ (定数) の微分: $(C)' = 0$
  2. $x^n$ の微分: $(x^n)' = nx^{n-1}$
  3. 定数倍の微分: $(Cf(x))' = C(f(x))'$
  4. 和・差の微分: $(f(x) \\pm g(x))' = f'(x) \\pm g'(x)$
  これらの公式を組み合わせることで、多くの関数を微分できます。
`,
                pitfall: {
                    title: "よくある間違い：定数の微分を1にしてしまう",
                    detail: `
定数（数字のみの項）の微分は常に0です。
例えば、$(x^2 + 5)' = (x^2)' + (5)' = 2x + 0 = 2x$ となります。
$5$を$1$にしてしまう間違いが多いので注意しましょう。
`,
                },
                problems: normalizeProblems([
                    {
                        question: "関数 $f(x) = 4x^3$ を微分しなさい。",
                        answer: "$12x^2$",
                        hint: "定数倍の公式と$x^n$の微分公式を使います。",
                    },
                    {
                        question:
                            "関数 $g(x) = x^5 - 2x^2 + 7$ を微分しなさい。",
                        answer: "$5x^4 - 4x$",
                        hint: "それぞれの項を個別に微分し、和・差の公式を適用しましょう。定数の微分に注意。",
                    },
                ]),
            },
            {
                title: "接線の傾き",
                explanation: `
  関数$y=f(x)$上の点$(a, f(a))$における接線の傾きは、その点での導関数の値、$f'(a)$で与えられます。
  つまり、導関数を求めてから$x=a$を代入すれば、接線の傾きがわかります。
`,
                pitfall: {
                    title: "よくある間違い：接線の傾きと接線の方程式を混同する",
                    detail: `
接線の傾きは単なる「数値」ですが、接線の方程式は「$y = mx + b$」のような「式」です。
接線の方程式を求めるには、傾き$m=f'(a)$と点$(a, f(a))$を使って、$y - f(a) = f'(a)(x - a)$ の公式を使います。
問題が「傾き」を求めているのか、「方程式」を求めているのか、よく確認しましょう。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "関数 $f(x) = x^2 + 3x$ の $x=1$ における接線の傾きを求めなさい。",
                        answer: "$5$",
                        hint: "まず$f'(x)$を求め、その後に$x=1$を代入しましょう。",
                    },
                    {
                        question:
                            "関数 $g(x) = 2x^3 - 4$ の $x=-1$ における接線の傾きを求めなさい。",
                        answer: "$6$",
                        hint: "同様に$g'(x)$を求めてから$x=-1$を代入します。",
                    },
                ]),
            },
            {
                title: "積の微分・商の微分",
                explanation: `
  関数の積や商を微分するための公式です。
  積の微分公式: $(f(x)g(x))' = f'(x)g(x) + f(x)g'(x)$
  商の微分公式: $\\left(\\frac{f(x)}{g(x)}\\right)' = \\frac{f'(x)g(x) - f(x)g'(x)}{(g(x))^2}$
  これらの公式は少し複雑ですが、慣れると非常に便利です。
`,
                pitfall: {
                    title: "よくある間違い：積の微分で単純にそれぞれを微分してしまう",
                    detail: `
$(f(x)g(x))' = f'(x)g'(x)$ と考えてしまう間違いが多いです。これは誤りです。
積の微分公式では、片方を微分し、もう片方はそのまま、という組み合わせを足し合わせます。
商の微分公式では、分子と分母の役割を間違えたり、分母を二乗し忘れたりすることに注意しましょう。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "関数 $f(x) = (x^2+1)(3x-2)$ を微分しなさい。",
                        answer: "$9x^2 - 4x + 3$",
                        hint: "積の微分公式 $(fg)' = f'g + fg'$ を使います。",
                    },
                    {
                        question:
                            "関数 $g(x) = \\frac{x}{x+1}$ を微分しなさい。",
                        answer: "$\\frac{1}{(x+1)^2}$",
                        hint: "商の微分公式 $\\left(\\frac{f}{g}\\right)' = \\frac{f'g - fg'}{g^2}$ を使います。",
                    },
                ]),
            },
            {
                title: "合成関数の微分",
                explanation: `
  関数の中に別の関数が入っている形（合成関数）を微分する公式です。
  $(f(g(x)))' = f'(g(x)) \\cdot g'(x)$
  つまり、「外側の関数を微分したもの」に「内側の関数を微分したもの」を掛け合わせます。
`,
                pitfall: {
                    title: "よくある間違い：内側の関数の微分を掛け忘れる",
                    detail: `
$(f(g(x)))'$ を $f'(g(x))$ だけで終わらせてしまう間違いが多いです。
例えば、$( (2x+1)^3 )'$ の場合、外側の関数は$(\\quad)^3$、内側の関数は$2x+1$です。
正しくは $3(2x+1)^2 \\cdot (2x+1)' = 3(2x+1)^2 \\cdot 2 = 6(2x+1)^2$ となります。
内側の関数の微分を掛け忘れないように注意しましょう。
`,
                },
                problems: normalizeProblems([
                    {
                        question: "関数 $f(x) = (3x-2)^4$ を微分しなさい。",
                        answer: "$12(3x-2)^3$",
                        hint: "外側の微分と内側の微分を掛け合わせる合成関数の微分公式を使います。",
                    },
                    {
                        question:
                            "関数 $g(x) = \\sqrt{x^2+1}$ を微分しなさい。",
                        answer: "$\\frac{x}{\\sqrt{x^2+1}}$",
                        hint: "$\\sqrt{u}$ の微分は $\\frac{1}{2\\sqrt{u}}$ で、これに内側の関数 $x^2+1$ の微分を掛けます。",
                    },
                ]),
            },
            {
                title: "高次導関数",
                explanation: `
  導関数をさらに微分することで、第二導関数、第三導関数などを求めることができます。
  $f(x)$ の導関数を $f'(x)$、第二導関数を $f''(x)$、$f'''(x)$、一般に $f^{(n)}(x)$ と表記します。
  これらの導関数は、関数の増減や凹凸、変曲点などを調べるのに役立ちます。
`,
                pitfall: {
                    title: "よくある間違い：計算ミスを繰り返す",
                    detail: `
高次導関数を求める際は、前の導関数の計算ミスが次の導関数に影響します。
一つ一つの微分の計算を丁寧に、正確に行うことが重要ですし、
特に符号や指数に注意しましょう。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "関数 $f(x) = x^4 - 3x^2 + 5$ の第二導関数 $f''(x)$ を求めなさい。",
                        answer: "$12x^2 - 6$",
                        hint: "一度微分して$f'(x)$を求め、さらにもう一度微分して$f''(x)$を求めます。",
                    },
                    {
                        question:
                            "関数 $g(x) = \\sin(2x)$ の第二導関数 $g''(x)$ を求めなさい。",
                        answer: "$-4\\sin(2x)$",
                        hint: "合成関数の微分も考慮しながら、2回微分してみましょう。",
                    },
                ]),
            },
            {
                title: "増減・凹凸とグラフ",
                explanation: `
  導関数 $f'(x)$ の符号は関数の増減を示します。$f'(x) > 0$ なら増加、$f'(x) < 0$ なら減少です。
  第二導関数 $f''(x)$ の符号は関数の凹凸を示します。$f''(x) > 0$ なら下に凸、$f''(x) < 0$ なら上に凸です。
  $f''(x)=0$ となる点で凹凸が変化する場合、その点を変曲点と呼びます。
  これらの情報を使って、関数のグラフの概形を描くことができます。
`,
                pitfall: {
                    title: "よくある間違い：増減と凹凸の混同",
                    detail: `
$f'(x)$ は傾き（増加/減少）に関する情報、$f''(x)$ は曲がり具合（凹凸）に関する情報です。
これらを混同すると、グラフの概形を間違えてしまいます。
それぞれの導関数が何を表しているのかをしっかりと理解しましょう。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "関数 $f(x) = x^3 - 3x$ の増減を調べ、極値を求めなさい。",
                        answer: "$x=-1$ で極大値 $2$, $x=1$ で極小値 $-2$",
                        hint: "$f'(x)$ を計算し、その符号の変化を調べましょう。",
                    },
                    {
                        question:
                            "関数 $f(x) = x^4 - 4x^3$ の凹凸を調べ、変曲点があればその座標を求めなさい。",
                        answer: "$x=0$ で変曲点 $(0,0)$, $x=2$ で変曲点 $(2,-16)$",
                        hint: "$f''(x)$ を計算し、その符号の変化を調べましょう。",
                    },
                ]),
            },
            {
                title: "最大・最小",
                explanation: `
  関数の最大値や最小値を求めるには、極値と定義域の端点での関数の値を比較します。
  閉区間 $[a, b]$ での最大値・最小値を求める手順は以下の通りです。
  1. $f'(x)=0$ となる$x$の値を求め、極値を計算する。
  2. 定義域の端点 $f(a)$、$f(b)$ の値を計算する。
  3. これらの値の中で最も大きいものが最大値、最も小さいものが最小値です。
`,
                pitfall: {
                    title: "よくある間違い：端点の値を考慮し忘れる",
                    detail: `
極値だけを調べて、定義域の端点での関数の値を考慮し忘れる間違いが多いです。
特に、定義域が閉区間である場合、最大値や最小値は極値ではなく端点でとることがあります。
必ず、極値と端点の両方を比較するようにしましょう。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "関数 $f(x) = x^3 - 3x^2 + 2$ の閉区間 $[-1, 3]$ における最大値と最小値を求めなさい。",
                        answer: "最大値: $2$ ($x=0$, $x=3$), 最小値: $-2$ ($x=2$)",
                        hint: "$f'(x)=0$となる点と、定義域の端点での関数値をすべて計算し、比較しましょう。",
                    },
                    {
                        question:
                            "関数 $g(x) = x + \\frac{4}{x}$ の $x>0$ における最小値を求めなさい。",
                        answer: "$4$",
                        hint: "相加平均・相乗平均の関係を使うか、$g'(x)$ を調べて増減表を書きましょう。",
                    },
                ]),
            },
        ],
    },
    {
        topic: "積分", // トピック名
        steps: [
            {
                title: "不定積分の概念と基本公式",
                explanation: `
  積分は微分の逆の操作です。ある関数を微分すると元の関数になるような関数を求めることを「積分」と呼びます。
  $f(x)$ の不定積分は $\\int f(x) dx$ と表記され、$F'(x) = f(x)$ となる $F(x)$ を $f(x)$ の原始関数と呼びます。
  不定積分の基本公式: $\\int x^n dx = \\frac{1}{n+1}x^{n+1} + C$ （ただし、$n \\neq -1$）
  $C$ は積分定数と呼ばれ、任意の定数です。
`,
                pitfall: {
                    title: "よくある間違い：積分定数Cを忘れる",
                    detail: `
不定積分では、必ず積分定数 $C$ を加える必要があります。
なぜなら、定数を微分すると0になるため、元の関数がどのような定数を含んでいたか分からないからです。
例えば、$(x^2)' = 2x$ ですが、$(x^2+5)' = 2x$ でもあります。
したがって、$\\int 2x dx = x^2 + C$ となります。
`,
                },
                problems: normalizeProblems([
                    {
                        question: "$\\int (3x^2 - 2x + 1) dx$ を求めなさい。",
                        answer: "$x^3 - x^2 + x + C$",
                        hint: "各項を個別に積分し、最後に積分定数Cをつけましょう。",
                    },
                    {
                        question:
                            "$\\int (\\sqrt{x} + \\frac{1}{x^2}) dx$ を求めなさい。",
                        answer: "$\\frac{2}{3} x^{\\frac{3}{2}} - \\frac{1}{x} + C$",
                        hint: "$\\sqrt{x} = x^{\\frac{1}{2}}$、$\\frac{1}{x^2} = x^{-2}$ と指数表記に直してから積分公式を使いましょう。",
                    },
                ]),
            },
            {
                title: "置換積分法",
                explanation: `
  複雑な形の積分を、変数変換によって簡単な形に変換してから積分する方法です。
  例えば、$\\int f(g(x))g'(x) dx$ のような形の場合、$u = g(x)$ と置くと $du = g'(x) dx$ となり、
  $\\int f(u) du$ の形に変換できます。
`,
                pitfall: {
                    title: "よくある間違い：dxの変換を忘れる、定積分の場合は積分範囲を変え忘れる",
                    detail: `
置換積分を行う際、最も忘れやすいのが $dx$ を $du$ に変換することです。
$du = g'(x) dx$ の関係を必ず利用しましょう。
また、定積分の場合は、変数を $x$ から $u$ に変えたら、積分範囲も $x$ の範囲から $u$ の範囲に変換する必要があります。
`,
                },
                problems: normalizeProblems([
                    {
                        question: "$\\int (2x+1)^3 dx$ を求めなさい。",
                        answer: "$\\frac{1}{8} (2x+1)^4 + C$",
                        hint: "$u = 2x+1$ と置いてみましょう。",
                    },
                    {
                        question: "$\\int x \\sqrt{x^2+1} dx$ を求めなさい。",
                        answer: "$\\frac{1}{3} (x^2+1)^{\\frac{3}{2}} + C$",
                        hint: "$u = x^2+1$ と置いてみましょう。",
                    },
                ]),
            },
            {
                title: "部分積分法",
                explanation: `
  積の形をした関数を積分するための公式です。
  $\\int f(x)g'(x) dx = f(x)g(x) - \\int f'(x)g(x) dx$
  この公式を使うには、$f(x)$ と $g'(x)$ を適切に選ぶことが重要です。
  一般的には、微分すると簡単になる関数を $f(x)$、積分しやすい関数を $g'(x)$ に選びます。
`,
                pitfall: {
                    title: "よくある間違い：f(x)とg'(x)の選び方を間違える",
                    detail: `
部分積分法は $f(x)$ と $g'(x)$ の選び方で計算の難易度が大きく変わります。
例えば、$\\int x e^x dx$ の場合、$f(x)=x, g'(x)=e^x$ と選ぶと計算が楽になります。
逆に選ぶと、より複雑な積分が出てきてしまいます。
「ロガリズミック（対数関数）、インバース（逆三角関数）、アルジェブライック（多項式）、トリゴノメトリック（三角関数）、エクスポネンシャル（指数関数）」の順で $f(x)$ を選ぶと良いとされています（Liateの法則）。
`,
                },
                problems: normalizeProblems([
                    {
                        question: "$\\int x e^x dx$ を求めなさい。",
                        answer: "$xe^x - e^x + C$",
                        hint: "$f(x) = x$, $g'(x) = e^x$ と置いて部分積分公式を適用しましょう。",
                    },
                    {
                        question: "$\\int x \\sin x dx$ を求めなさい。",
                        answer: "$-x \\cos x + \\sin x + C$",
                        hint: "$f(x) = x$, $g'(x) = \\sin x$ と置いて部分積分公式を適用しましょう。",
                    },
                ]),
            },
            {
                title: "定積分の概念と計算",
                explanation: `
  定積分は、関数とx軸で囲まれた部分の面積を求めることに対応します。
  不定積分と異なり、積分範囲（下端と上端）が指定され、結果は数値になります。
  $\\int_a^b f(x) dx = [F(x)]_a^b = F(b) - F(a)$
  ここで $F(x)$ は $f(x)$ の原始関数です。
`,
                pitfall: {
                    title: "よくある間違い：計算ミスや符号ミス",
                    detail: `
定積分の計算では、$F(b) - F(a)$ の引き算の順序や、負の数の計算での符号ミスがよく発生します。
特に、原始関数を求めた後に代入する値を間違えたり、引き算の際に括弧を付け忘れたりしないように注意しましょう。
`,
                },
                problems: normalizeProblems([
                    {
                        question: "$\\int_0^1 (x^2 + 1) dx$ を計算しなさい。",
                        answer: "$\\frac{4}{3}$",
                        hint: "まず不定積分を求め、その後で上端と下端の値を代入して引き算します。",
                    },
                    {
                        question: "$\\int_1^2 (3x^2 - 4x) dx$ を計算しなさい。",
                        answer: "$2$",
                        hint: "不定積分を求めてから、$[F(x)]_1^2 = F(2) - F(1)$ を計算します。",
                    },
                ]),
            },
            {
                title: "面積",
                explanation: `
  定積分は、曲線とx軸、または複数の曲線で囲まれた領域の面積を求めるのにも使われます。
  x軸より上にある部分の面積は正、下にある部分の面積は負として計算されます。
  面積を求める場合は、常に正の値になるように絶対値を取ったり、区間を分けたりする必要があります。
  2つの曲線 $y=f(x)$ と $y=g(x)$ で囲まれた面積は、$\\int_a^b |f(x) - g(x)| dx$ で求められます。
`,
                pitfall: {
                    title: "よくある間違い：x軸より下の部分の符号を考慮しない",
                    detail: `
面積は常に正の値です。関数がx軸の下にある区間では、定積分の値は負になります。
この場合、その区間の定積分の値に絶対値をつけるか、$-f(x)$ を積分するようにしましょう。
また、複数の曲線で囲まれる場合は、どちらの関数が上にあるかを区間ごとに確認しましょう。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "曲線 $y = x^2 - 1$ と $x$軸で囲まれた部分の面積を求めなさい。",
                        answer: "$\\frac{4}{3}$",
                        hint: "曲線がx軸と交わる点を求め、その区間で積分します。x軸より下の部分の符号に注意しましょう。",
                    },
                    {
                        question:
                            "2つの曲線 $y = x^2$ と $y = x+2$ で囲まれた部分の面積を求めなさい。",
                        answer: "$\\frac{9}{2}$",
                        hint: "2つの曲線の交点を求め、どちらの関数が上にあるかを確認して積分します。",
                    },
                ]),
            },
            {
                title: "体積",
                explanation: `
  積分は、図形を回転させてできる立体の体積を求めるのにも使われます（回転体の体積）。
  関数 $y=f(x)$ を $x$軸の周りに回転させてできる立体の体積は、
  $\\int_a^b \\pi (f(x))^2 dx$ で求められます。
  これは、円の面積 $\\pi r^2$ を積み重ねていくイメージです。
`,
                pitfall: {
                    title: "よくある間違い：公式の適用ミス",
                    detail: `
体積の公式で $\\pi$ を掛け忘れたり、$f(x)$ を二乗し忘れたりすることがよくあります。
また、回転軸が $x$軸以外の場合や、2つの曲線間の回転体の体積を求める場合は、公式が少し変わるため注意が必要です。
公式の意味を理解し、正しく適用することが大切です。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "曲線 $y = \\sqrt{x}$ と $x$軸、直線 $x=1$ で囲まれた部分を $x$軸の周りに回転させてできる立体の体積を求めなさい。",
                        answer: "$\\frac{\\pi}{2}$",
                        hint: "公式 $\\int_a^b \\pi (f(x))^2 dx$ を使います。$f(x) = \\sqrt{x}$ です。",
                    },
                    {
                        question:
                            "曲線 $y = x^2$ と直線 $y=x$ で囲まれた部分を $x$軸の周りに回転させてできる立体の体積を求めなさい。",
                        answer: "$\\frac{2\\pi}{15}$",
                        hint: "2つの曲線で囲まれた領域を回転させる場合、外側の半径の二乗から内側の半径の二乗を引いたものを積分します。",
                    },
                ]),
            },
        ],
    },
];

// 数学C の学習コンテンツ（新課程）
const mathCLessons: LearningTopic[] = [
    {
        topic: "ベクトル",
        steps: [
            {
                title: "平面ベクトル",
                explanation: `
ベクトルは「大きさ」と「向き」を持つ量です。矢印で表され、$\\vec{a}$ のように記号で表します。

平面ベクトルの基本：
・ベクトルの和：$\\vec{a} + \\vec{b}$ は平行四辺形の対角線
・ベクトルの差：$\\vec{a} - \\vec{b}$ は $\\vec{a} + (-\\vec{b})$
・スカラー倍：$k\\vec{a}$ は $\\vec{a}$ を $k$ 倍に拡大・縮小

座標表示では、$\\vec{a} = (a_1, a_2)$ のように表します。

ポイント：
・ベクトルは「移動」を表す
・座標とベクトルは区別して考える
・図を描いてイメージを掴むことが大切
`,
                pitfall: {
                    title: "よくある間違い：ベクトルと座標の混同",
                    detail: `
ベクトルは「移動」を表し、座標は「位置」を表します。$\\vec{AB}$ は点Aから点Bへの移動を表し、
$B - A$ で計算できます。また、ベクトルの計算では、向きと大きさを正確に把握することが重要です。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "点 $A(1,2)$ から点 $B(4,6)$ へのベクトル $\\vec{AB}$ を求めなさい。",
                        answer: "$\\vec{AB} = (3,4)$",
                        hint: "$\\vec{AB} = B - A$ の公式を使います。",
                    },
                    {
                        question:
                            "ベクトル $\\vec{a} = (2,3)$ と $\\vec{b} = (1,-1)$ の和 $\\vec{a} + \\vec{b}$ を求めなさい。",
                        answer: "$(3,2)$",
                        hint: "対応する成分同士を足し合わせます。",
                    },
                ]),
            },
            {
                title: "空間ベクトル",
                explanation: `
空間ベクトルは3次元空間でのベクトルです。$\\vec{a} = (a_1, a_2, a_3)$ のように3つの成分で表されます。

空間ベクトルの特徴：
・3つの座標軸（x軸、y軸、z軸）に沿った成分を持つ
・平面ベクトルと同様に、和・差・スカラー倍が定義される
・空間での直線や平面の方程式をベクトルで表現できる

空間での直線のベクトル方程式：
$\\vec{r} = \\vec{a} + t\\vec{d}$ （$\\vec{a}$ は直線上の点、$\\vec{d}$ は方向ベクトル）

ポイント：
・3次元のイメージを掴むことが重要
・座標軸を正しく設定する
・図を描いて空間的な関係を理解する
`,
                pitfall: {
                    title: "よくある間違い：3次元のイメージ不足",
                    detail: `
空間ベクトルでは、3次元の関係を正確に把握することが難しい場合があります。
特に、直線や平面の位置関係、角度の計算では、図を描いて確認することが重要です。
また、座標軸の設定を間違えると、計算結果が大きく変わってしまいます。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "点 $A(1,2,3)$ から点 $B(4,5,6)$ へのベクトル $\\vec{AB}$ を求めなさい。",
                        answer: "$\\vec{AB} = (3,3,3)$",
                        hint: "3次元でも $\\vec{AB} = B - A$ の公式が使えます。",
                    },
                    {
                        question:
                            "ベクトル $\\vec{a} = (1,2,3)$ と $\\vec{b} = (2,1,0)$ の内積 $\\vec{a} \\cdot \\vec{b}$ を求めなさい。",
                        answer: "$4$",
                        hint: "内積は対応する成分の積の和です：$a_1b_1 + a_2b_2 + a_3b_3$",
                    },
                ]),
            },
            {
                title: "内積",
                explanation: `
ベクトルの内積は、2つのベクトルの「類似度」を表す重要な概念です。

内積の定義：
$\\vec{a} \\cdot \\vec{b} = |\\vec{a}||\\vec{b}|\\cos\\theta$
ここで $\\theta$ は2つのベクトルのなす角です。

座標表示での計算：
$\\vec{a} = (a_1, a_2, a_3)$、$\\vec{b} = (b_1, b_2, b_3)$ のとき
$\\vec{a} \\cdot \\vec{b} = a_1b_1 + a_2b_2 + a_3b_3$

内積の性質：
・$\\vec{a} \\cdot \\vec{b} = \\vec{b} \\cdot \\vec{a}$ （交換法則）
・$\\vec{a} \\cdot (\\vec{b} + \\vec{c}) = \\vec{a} \\cdot \\vec{b} + \\vec{a} \\cdot \\vec{c}$ （分配法則）
・$\\vec{a} \\perp \\vec{b} \\Leftrightarrow \\vec{a} \\cdot \\vec{b} = 0$ （垂直条件）

ポイント：
・内積は「投影」の概念と密接に関連
・垂直条件は内積=0で判定
・角度の計算にも利用される
`,
                pitfall: {
                    title: "よくある間違い：内積と外積の混同",
                    detail: `
内積はスカラー（数値）を返し、外積はベクトルを返します。内積は $\\vec{a} \\cdot \\vec{b}$ で表し、
外積は $\\vec{a} \\times \\vec{b}$ で表します。また、内積の計算では、対応する成分の積の和を取ることを忘れがちです。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "ベクトル $\\vec{a} = (1,2)$ と $\\vec{b} = (3,4)$ の内積を求めなさい。",
                        answer: "$11$",
                        hint: "$\\vec{a} \\cdot \\vec{b} = 1 \\times 3 + 2 \\times 4$",
                    },
                    {
                        question:
                            "ベクトル $\\vec{a} = (1,0)$ と $\\vec{b} = (0,1)$ が垂直であることを内積を使って証明しなさい。",
                        answer: "$\\vec{a} \\cdot \\vec{b} = 1 \\times 0 + 0 \\times 1 = 0$ より、$\\vec{a} \\perp \\vec{b}$",
                        hint: "垂直条件は内積=0です。",
                    },
                ]),
            },
        ],
    },
    {
        topic: "平面上の曲線と複素数平面",
        steps: [
            {
                title: "二次曲線",
                explanation: `
二次曲線は、2次方程式で表される曲線です。主なものに円、楕円、双曲線、放物線があります。

円：$(x-a)^2 + (y-b)^2 = r^2$ （中心 $(a,b)$、半径 $r$）
楕円：$\\frac{x^2}{a^2} + \\frac{y^2}{b^2} = 1$ （$a > b > 0$）
双曲線：$\\frac{x^2}{a^2} - \\frac{y^2}{b^2} = 1$ または $\\frac{y^2}{a^2} - \\frac{x^2}{b^2} = 1$
放物線：$y = ax^2 + bx + c$ または $x = ay^2 + by + c$

各曲線の特徴：
・円：中心からの距離が一定
・楕円：2つの焦点からの距離の和が一定
・双曲線：2つの焦点からの距離の差が一定
・放物線：焦点と準線からの距離が等しい

ポイント：
・標準形に変形して特徴を把握
・焦点や準線の位置を確認
・グラフの概形を描いて理解する
`,
                pitfall: {
                    title: "よくある間違い：標準形への変形ミス",
                    detail: `
二次曲線の方程式を標準形に変形する際、平方完成や分母の処理でミスが起こりがちです。
特に、楕円や双曲線では分母の大小関係を間違えると、焦点の位置や曲線の形状が変わってしまいます。
また、放物線では軸の方向を間違えることがあります。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "円 $(x-2)^2 + (y+1)^2 = 9$ の中心と半径を求めなさい。",
                        answer: "中心 $(2,-1)$、半径 $3$",
                        hint: "標準形 $(x-a)^2 + (y-b)^2 = r^2$ と比較します。",
                    },
                    {
                        question:
                            "楕円 $\\frac{x^2}{16} + \\frac{y^2}{9} = 1$ の焦点を求めなさい。",
                        answer: "$(\\pm\\sqrt{7}, 0)$",
                        hint: "焦点は $c = \\sqrt{a^2 - b^2}$ で求められます。",
                    },
                ]),
            },
            {
                title: "媒介変数表示",
                explanation: `
媒介変数表示は、曲線上の点の座標を別の変数（媒介変数）で表す方法です。

円の媒介変数表示：
$x = a + r\\cos\\theta$、$y = b + r\\sin\\theta$ （中心 $(a,b)$、半径 $r$）

楕円の媒介変数表示：
$x = a\\cos\\theta$、$y = b\\sin\\theta$ （$a > b > 0$）

直線の媒介変数表示：
$x = x_1 + at$、$y = y_1 + bt$ （点 $(x_1,y_1)$ を通り、方向ベクトル $(a,b)$ の直線）

媒介変数表示の利点：
・曲線の性質を理解しやすい
・積分計算が簡単になる場合がある
・動的な変化を表現できる

ポイント：
・媒介変数の範囲を確認
・曲線の向きを把握
・積分での利用を理解する
`,
                pitfall: {
                    title: "よくある間違い：媒介変数の範囲の見落とし",
                    detail: `
媒介変数表示では、媒介変数の範囲を正確に設定することが重要です。範囲を間違えると、
曲線の一部しか表せなかったり、同じ点を複数回通ったりしてしまいます。また、積分計算では、
媒介変数の微分 $\\frac{dx}{dt}$、$\\frac{dy}{dt}$ を正確に計算する必要があります。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "円 $x^2 + y^2 = 4$ の媒介変数表示を求めなさい。",
                        answer: "$x = 2\\cos\\theta$、$y = 2\\sin\\theta$ （$0 \\le \\theta < 2\\pi$）",
                        hint: "中心が原点、半径2の円の標準的な媒介変数表示です。",
                    },
                    {
                        question:
                            "媒介変数表示 $x = t^2$、$y = t$ で表される曲線の概形を説明しなさい。",
                        answer: "放物線 $y^2 = x$ の右半分",
                        hint: "$y = t$ から $t = y$ を $x = t^2$ に代入します。",
                    },
                ]),
            },
            {
                title: "複素数の極形式",
                explanation: `
複素数 $z = a + bi$ は、極形式 $z = r(\\cos\\theta + i\\sin\\theta)$ で表すことができます。

極形式の要素：
・$r = |z| = \\sqrt{a^2 + b^2}$ （絶対値）
・$\\theta = \\arg z$ （偏角）

複素数の乗法：
$z_1 = r_1(\\cos\\theta_1 + i\\sin\\theta_1)$、$z_2 = r_2(\\cos\\theta_2 + i\\sin\\theta_2)$ のとき
$z_1 \\cdot z_2 = r_1r_2(\\cos(\\theta_1 + \\theta_2) + i\\sin(\\theta_1 + \\theta_2))$

複素数の除法：
$\\frac{z_1}{z_2} = \\frac{r_1}{r_2}(\\cos(\\theta_1 - \\theta_2) + i\\sin(\\theta_1 - \\theta_2))$

ド・モアブルの定理：
$(\\cos\\theta + i\\sin\\theta)^n = \\cos(n\\theta) + i\\sin(n\\theta)$

ポイント：
・絶対値は「大きさ」、偏角は「向き」を表す
・乗法では絶対値は積、偏角は和
・除法では絶対値は商、偏角は差
`,
                pitfall: {
                    title: "よくある間違い：偏角の計算ミス",
                    detail: `
偏角の計算では、複素数がどの象限にあるかを正確に判断することが重要です。
特に、$\\arctan$ 関数は $(-\\frac{\\pi}{2}, \\frac{\\pi}{2})$ の範囲の値を返すため、
第2象限や第3象限の複素数の偏角を求める際は、$\\pi$ を加える必要があります。
また、ド・モアブルの定理を使う際は、指数が整数であることを確認しましょう。
`,
                },
                problems: normalizeProblems([
                    {
                        question: "複素数 $z = 1 + i$ の極形式を求めなさい。",
                        answer: "$z = \\sqrt{2}(\\cos\\frac{\\pi}{4} + i\\sin\\frac{\\pi}{4})$",
                        hint: "$r = \\sqrt{1^2 + 1^2} = \\sqrt{2}$、$\\theta = \\frac{\\pi}{4}$",
                    },
                    {
                        question:
                            "複素数 $z = 2(\\cos\\frac{\\pi}{3} + i\\sin\\frac{\\pi}{3})$ の3乗を求めなさい。",
                        answer: "$8(\\cos\\pi + i\\sin\\pi) = -8$",
                        hint: "ド・モアブルの定理を使います。",
                    },
                ]),
            },
        ],
    },
    {
        topic: "数学的な表現の工夫",
        steps: [
            {
                title: "離散グラフ",
                explanation: `
離散グラフは、頂点と辺からなる数学的構造で、様々な問題を表現するのに役立ちます。

グラフの基本概念：
・頂点（vertex）：グラフの点
・辺（edge）：頂点を結ぶ線
・次数（degree）：頂点に接続する辺の数
・道（path）：頂点を辿って移動する経路
・閉路（cycle）：始点と終点が同じ道

グラフの種類：
・無向グラフ：辺に方向がない
・有向グラフ：辺に方向がある
・重み付きグラフ：辺に数値（重み）が付いている
・完全グラフ：任意の2頂点間に辺がある

グラフの応用：
・ネットワーク解析
・スケジューリング問題
・最短経路問題
・色分け問題

ポイント：
・問題をグラフで表現する
・グラフの性質を利用して解法を考える
・アルゴリズムの理解が重要
`,
                pitfall: {
                    title: "よくある間違い：グラフの表現ミス",
                    detail: `
グラフを描く際、頂点や辺の関係を正確に表現することが重要です。特に、有向グラフでは
辺の向きを間違えたり、重み付きグラフでは重みを書き忘れたりすることがあります。
また、グラフの性質（連結性、平面性など）を見落とすと、問題の解決が困難になります。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "4つの頂点を持つ完全グラフの辺の数を求めなさい。",
                        answer: "$6$",
                        hint: "完全グラフでは、任意の2頂点間に辺があります。",
                    },
                    {
                        question:
                            "5つの頂点を一筆書きで全て通る道が存在するための必要十分条件を述べなさい。",
                        answer: "グラフが連結で、奇数次数の頂点が0個または2個であること",
                        hint: "オイラー路の存在条件を考えます。",
                    },
                ]),
            },
            {
                title: "行列を用いた表現",
                explanation: `
行列は、線形変換や連立方程式、グラフの表現などに用いられる強力な数学的ツールです。

行列の基本：
・$m \\times n$ 行列：$m$ 行 $n$ 列の数表
・正方行列：行数と列数が等しい行列
・単位行列：対角成分が1、他が0の正方行列

行列の演算：
・加法：対応する成分の和
・スカラー倍：各成分を定数倍
・乗法：行と列の内積

行列の応用：
・連立方程式の解法
・線形変換の表現
・グラフの隣接行列
・確率過程の表現

逆行列：
正方行列 $A$ に対して、$AA^{-1} = A^{-1}A = I$ となる $A^{-1}$ が存在するとき、
$A$ は正則（可逆）であるといいます。

ポイント：
・行列のサイズを確認
・演算の順序に注意
・逆行列の存在条件を理解
`,
                pitfall: {
                    title: "よくある間違い：行列の乗法の順序",
                    detail: `
行列の乗法は非可換です。つまり、$AB \\neq BA$ のことがあります。
また、行列の乗法では、左の行列の列数と右の行列の行数が等しい必要があります。
逆行列を求める際は、行列式が0でないことを確認する必要があります。
`,
                },
                problems: normalizeProblems([
                    {
                        question:
                            "行列 $A = \\begin{pmatrix} 1 & 2 \\\\ 3 & 4 \\end{pmatrix}$ と $B = \\begin{pmatrix} 2 & 0 \\\\ 1 & 1 \\end{pmatrix}$ の積 $AB$ を求めなさい。",
                        answer: "$\\begin{pmatrix} 4 & 2 \\\\ 10 & 4 \\end{pmatrix}$",
                        hint: "行列の乗法の定義に従って計算します。",
                    },
                    {
                        question:
                            "行列 $A = \\begin{pmatrix} 2 & 1 \\\\ 1 & 1 \\end{pmatrix}$ の逆行列を求めなさい。",
                        answer: "$\\begin{pmatrix} 1 & -1 \\\\ -1 & 2 \\end{pmatrix}$",
                        hint: "逆行列の公式または掃き出し法を使います。",
                    },
                ]),
            },
        ],
    },
];

// 全ての科目のデータをまとめる
const allSubjectsData: SubjectData = {
    数学I: math1Lessons,
    数学A: mathALessons,
    数学II: math2Lessons,
    数学B: mathBLessons,
    数学III: math3Lessons, // 既存の微分積分コンテンツを数学IIIとして利用
    数学C: mathCLessons, // 新課程の数学Cを追加
};

export default allSubjectsData;
